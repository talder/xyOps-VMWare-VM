{
	"type": "xypdf",
	"description": "xyOps Portable Data Object",
	"version": "1.0",
	"items": [
		{
			"type": "plugin",
			"data": {
				"id": "pml4zqdvfc9on6hn",
				"title": "VMware VM Operations",
				"enabled": true,
				"type": "event",
				"command": "pwsh",
				"script": "# xyOps VMware VM Operations Plugin - PowerShell Version\n# Manages VMware virtual machines using VMware PowerCLI\n\nfunction Write-Output-JSON {\n    param($Object)\n    $json = $Object | ConvertTo-Json -Compress -Depth 100\n    Write-Output $json\n    [Console]::Out.Flush()\n}\n\nfunction Send-Progress {\n    param([double]$Value)\n    Write-Output-JSON @{ xy = 1; progress = $Value }\n}\n\nfunction Send-Success {\n    param([string]$Description = \"Operation completed successfully\")\n    Write-Output-JSON @{ xy = 1; code = 0; description = $Description }\n}\n\nfunction Send-Error {\n    param([int]$Code, [string]$Description)\n    Write-Output-JSON @{ xy = 1; code = $Code; description = $Description }\n}\n\nfunction Test-SnapshotException {\n    param(\n        [string]$SnapshotName,\n        [string]$SnapshotDescription,\n        [string]$ExceptionList\n    )\n    \n    # If no exceptions provided, don't skip\n    if ([string]::IsNullOrWhiteSpace($ExceptionList)) {\n        return $false\n    }\n    \n    # Parse comma-separated exception strings\n    $exceptions = $ExceptionList -split ',' | ForEach-Object { $_.Trim() } | Where-Object { -not [string]::IsNullOrWhiteSpace($_) }\n    \n    # Check if snapshot name or description contains any exception string (case-insensitive)\n    foreach ($exception in $exceptions) {\n        if ($SnapshotName -match [regex]::Escape($exception) -or \n            $SnapshotDescription -match [regex]::Escape($exception)) {\n            return $true\n        }\n    }\n    \n    return $false\n}\n\n# Read input from STDIN\n$inputJson = [Console]::In.ReadToEnd()\n\ntry {\n    $jobData = $inputJson | ConvertFrom-Json -AsHashtable\n}\ncatch {\n    Send-Error -Code 1 -Description \"Failed to parse input JSON: $($_.Exception.Message)\"\n    exit 1\n}\n\n# Extract parameters\n$params = $jobData.params\n\n# Helper function to get parameter value case-insensitively\nfunction Get-ParamValue {\n    param($ParamsObject, [string]$ParamName)\n    if ($ParamsObject -is [hashtable]) {\n        foreach ($key in $ParamsObject.Keys) {\n            if ($key -ieq $ParamName) {\n                return $ParamsObject[$key]\n            }\n        }\n        return $null\n    } else {\n        $prop = $ParamsObject.PSObject.Properties | Where-Object { $_.Name -ieq $ParamName } | Select-Object -First 1\n        if ($prop) { return $prop.Value }\n        return $null\n    }\n}\n\n# Check if debug mode is enabled\n$debugRaw = Get-ParamValue -ParamsObject $params -ParamName 'debug'\n$debug = if ($debugRaw -eq $true -or $debugRaw -eq \"true\" -or $debugRaw -eq \"True\") { $true } else { $false }\n\n# Performance tracking\n$perf = @{}\n$overallSW = [System.Diagnostics.Stopwatch]::StartNew()\n\n# If debug is enabled, output the incoming JSON\nif ($debug) {\n    Write-Host \"=== DEBUG: Incoming JSON ===\"\n    $debugData = @{}\n    if ($jobData -is [hashtable]) {\n        foreach ($key in $jobData.Keys) {\n            if ($key -ne 'script') {\n                $debugData[$key] = $jobData[$key]\n            }\n        }\n    } else {\n        foreach ($prop in $jobData.PSObject.Properties) {\n            if ($prop.Name -ne 'script') {\n                $debugData[$prop.Name] = $prop.Value\n            }\n        }\n    }\n    $formattedJson = $debugData | ConvertTo-Json -Depth 10\n    Write-Host $formattedJson\n    Write-Host \"=== END DEBUG ===\"\n}\n\n# Get parameters\n$vcenterServer = Get-ParamValue -ParamsObject $params -ParamName 'vcenterserver'\n$username = $env:VMWARE_USERNAME\n$password = $env:VMWARE_PASSWORD\n$ignoreCertRaw = Get-ParamValue -ParamsObject $params -ParamName 'ignorecert'\n$ignoreCert = if ($ignoreCertRaw -eq $true -or $ignoreCertRaw -eq \"true\" -or $ignoreCertRaw -eq \"True\") { $true } else { $false }\n$proxyPolicyRaw = Get-ParamValue -ParamsObject $params -ParamName 'proxypolicy'\n$noProxy = if ($proxyPolicyRaw -eq $true -or $proxyPolicyRaw -eq \"true\" -or $proxyPolicyRaw -eq \"True\") { $true } else { $false }\n$viServerModeRaw = Get-ParamValue -ParamsObject $params -ParamName 'viservermode'\n$singleMode = if ($viServerModeRaw -eq $true -or $viServerModeRaw -eq \"true\" -or $viServerModeRaw -eq \"True\") { $true } else { $false }\n$selectedAction = Get-ParamValue -ParamsObject $params -ParamName 'selectedaction'\n$exportFormatRaw = Get-ParamValue -ParamsObject $params -ParamName 'exportformat'\n$exportFormat = if ([string]::IsNullOrWhiteSpace($exportFormatRaw)) { \"JSON\" } else { $exportFormatRaw.ToUpper() }\n$exportToFileRaw = Get-ParamValue -ParamsObject $params -ParamName 'exporttofile'\n$exportToFile = if ($exportToFileRaw -eq $true -or $exportToFileRaw -eq \"true\" -or $exportToFileRaw -eq \"True\") { $true } else { $false }\n$dateInput = Get-ParamValue -ParamsObject $params -ParamName 'dateinput'\n$numberOfWeeks = Get-ParamValue -ParamsObject $params -ParamName 'numberofweeks'\n$snapshotRemovalException = Get-ParamValue -ParamsObject $params -ParamName 'snapshotremovalexception'\n$vmName = Get-ParamValue -ParamsObject $params -ParamName 'vmname'\n$snapshotName = Get-ParamValue -ParamsObject $params -ParamName 'snapshotname'\n$snapshotDescription = Get-ParamValue -ParamsObject $params -ParamName 'snapshotdescription'\n$snapshotMemoryRaw = Get-ParamValue -ParamsObject $params -ParamName 'snapshotmemory'\n$snapshotMemory = if ($snapshotMemoryRaw -eq $true -or $snapshotMemoryRaw -eq \"true\" -or $snapshotMemoryRaw -eq \"True\") { $true } else { $false }\n$snapshotUnique = Get-ParamValue -ParamsObject $params -ParamName 'snapshotunique'\n$updateVCFPowerCLIRaw = Get-ParamValue -ParamsObject $params -ParamName 'updateVCFPowerCLI'\n$updateVCFPowerCLI = if ($updateVCFPowerCLIRaw -eq $true -or $updateVCFPowerCLIRaw -eq \"true\" -or $updateVCFPowerCLIRaw -eq \"True\") { $true } else { $false }\n\n# Validate required parameters\n$missing = @()\n\n# Check vCenter server parameter\nif ([string]::IsNullOrWhiteSpace($vcenterServer)) {\n    $missing += 'vcenterserver'\n}\n\n# Check username from environment variable\nif ([string]::IsNullOrWhiteSpace($username)) {\n    $missing += 'VMWARE_USERNAME (environment variable)'\n}\n\n# Check password from environment variable\nif ([string]::IsNullOrWhiteSpace($password)) {\n    $missing += 'VMWARE_PASSWORD (environment variable)'\n}\n\n# Check selected action\nif ([string]::IsNullOrWhiteSpace($selectedAction)) {\n    $missing += 'selectedaction'\n}\n\n# Check dateInput if action is 'Remove snapshots before date'\nif ($selectedAction -and $selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS BEFORE DATE\") {\n    if ([string]::IsNullOrWhiteSpace($dateInput)) {\n        $missing += 'dateinput'\n    }\n}\n\n# Check numberOfWeeks if action is 'Remove snapshots before number of weeks'\nif ($selectedAction -and $selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS BEFORE NUMBER OF WEEKS\") {\n    if ([string]::IsNullOrWhiteSpace($numberOfWeeks)) {\n        $missing += 'numberofweeks'\n    }\n}\n\n# Check vmname if action is 'Create VM snapshot'\nif ($selectedAction -and $selectedAction.ToUpper() -eq \"CREATE VM SNAPSHOT\") {\n    if ([string]::IsNullOrWhiteSpace($vmName)) {\n        $missing += 'vmname'\n    }\n}\n\n# Check snapshotname if action is 'Remove snapshots containing specific text'\nif ($selectedAction -and $selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS CONTAINING SPECIFIC TEXT\") {\n    if ([string]::IsNullOrWhiteSpace($snapshotName)) {\n        $missing += 'snapshotname'\n    }\n}\n\nif ($missing.Count -gt 0) {\n    Send-Error -Code 2 -Description \"Missing required parameters: $($missing -join ', '). Credentials must be provided via secret vault environment variables.\"\n    exit 1\n}\n\ntry {\n    # Check if VCF.PowerCLI module is installed\n    Send-Progress -Value 0.1\n    \n    $moduleInstallSW = [System.Diagnostics.Stopwatch]::StartNew()\n    \n    $powerCLIModule = Get-Module -ListAvailable -Name VCF.PowerCLI | Select-Object -First 1\n    \n    if (-not $powerCLIModule) {\n        try {\n            Write-Host \"VCF.PowerCLI module not found, attempting to install...\"\n            # Use -SkipPublisherCheck to handle publisher changes (VMware -> Broadcom)\n            Install-Module -Name VCF.PowerCLI -Force -AllowClobber -Scope CurrentUser -SkipPublisherCheck -ErrorAction Stop\n            Write-Host \"VCF.PowerCLI module installed successfully\"\n        }\n        catch {\n            Send-Error -Code 3 -Description \"Failed to install required VCF.PowerCLI module. Please install it manually by running: Install-Module -Name VCF.PowerCLI -Force -SkipPublisherCheck (Install error: $($_.Exception.Message))\"\n            exit 1\n        }\n    } else {\n        Write-Host \"VCF.PowerCLI module found: Version $($powerCLIModule.Version)\"\n        \n        # Check if an update is available (only if updateVCFPowerCLI parameter is enabled)\n        if ($updateVCFPowerCLI) {\n            Write-Host \"Update check enabled - checking for VCF.PowerCLI updates...\"\n            try {\n                $latestVersion = Find-Module -Name VCF.PowerCLI -ErrorAction SilentlyContinue | Select-Object -First 1\n                if ($latestVersion -and $latestVersion.Version -gt $powerCLIModule.Version) {\n                    Write-Host \"Updating VCF.PowerCLI from version $($powerCLIModule.Version) to $($latestVersion.Version)...\"\n                    Update-Module -Name VCF.PowerCLI -Force -SkipPublisherCheck -ErrorAction Stop\n                    Write-Host \"VCF.PowerCLI module updated successfully\"\n                } else {\n                    Write-Host \"VCF.PowerCLI is already up-to-date (version $($powerCLIModule.Version))\"\n                }\n            }\n            catch {\n                # Update failed, but we can continue with existing version\n                Write-Host \"Could not update VCF.PowerCLI module, using existing version $($powerCLIModule.Version)\"\n            }\n        } else {\n            Write-Host \"Update check disabled - using existing VCF.PowerCLI version $($powerCLIModule.Version)\"\n        }\n    }\n    \n    $moduleInstallSW.Stop(); $perf.module_install = [math]::Round($moduleInstallSW.Elapsed.TotalSeconds,3); if ($debug) { Write-Host (\"PERF module_install={0:n3}s\" -f $perf.module_install) }\n    \n    # Import only the Core PowerCLI module for faster startup (keep VCF.PowerCLI for install/update checks)\n    Send-Progress -Value 0.2\n    $moduleImportSW = [System.Diagnostics.Stopwatch]::StartNew()\n    \n    $loadedCore = Get-Module -Name VMware.VimAutomation.Core\n    if (-not $loadedCore) {\n        Write-Host \"Loading VMware.VimAutomation.Core module (optimized path)...\"\n        try {\n            Import-Module VMware.VimAutomation.Core -ErrorAction Stop\n            $loadedCore = Get-Module -Name VMware.VimAutomation.Core\n            Write-Host \"VMware.VimAutomation.Core loaded successfully (version $($loadedCore.Version))\"\n        }\n        catch {\n            Write-Host \"Failed to load VMware.VimAutomation.Core directly: $($_.Exception.Message). Falling back to VCF.PowerCLI import...\"\n            # Fallback to umbrella module if direct Core import fails\n            Import-Module VCF.PowerCLI -ErrorAction Stop\n            Write-Host \"VCF.PowerCLI module loaded successfully (fallback)\"\n        }\n    } else {\n        Write-Host \"VMware.VimAutomation.Core already loaded (version $($loadedCore.Version))\"\n    }\n    $moduleImportSW.Stop(); $perf.module_import = [math]::Round($moduleImportSW.Elapsed.TotalSeconds,3); if ($debug) { Write-Host (\"PERF module_import={0:n3}s\" -f $perf.module_import) }\n    \n    # Configure PowerCLI settings\n    Send-Progress -Value 0.3\n    $configSW = [System.Diagnostics.Stopwatch]::StartNew()\n    Write-Host \"Configuring PowerCLI settings...\"\n    \n    # Determine InvalidCertificateAction\n    $certAction = if ($ignoreCert) { \"Ignore\" } else { \"Warn\" }\n    \n    # Determine ProxyPolicy\n    $proxyPolicy = if ($noProxy) { \"NoProxy\" } else { \"UseSystemProxy\" }\n    \n    # Determine DefaultVIServerMode\n    $viServerMode = if ($singleMode) { \"Single\" } else { \"Multiple\" }\n    \n    Write-Host \"PowerCLI Config: InvalidCertificateAction=$certAction, ProxyPolicy=$proxyPolicy, DefaultVIServerMode=$viServerMode\"\n    \n    # Only set configuration if values differ (to avoid slow disk writes every run)\n    $currentCfg = Get-PowerCLIConfiguration -Scope User -ErrorAction SilentlyContinue | Select-Object -First 1\n    $currentInvalid = $null; if ($currentCfg) { $currentInvalid = $currentCfg.InvalidCertificateAction }\n    $currentProxy = $null; if ($currentCfg) { $currentProxy = $currentCfg.ProxyPolicy }\n    $currentMode = $null; if ($currentCfg) { $currentMode = $currentCfg.DefaultVIServerMode }\n    $currentCeip = $null; if ($currentCfg) {\n        if ($currentCfg.PSObject.Properties.Name -contains 'ParticipateInCEIP') { $currentCeip = $currentCfg.ParticipateInCEIP }\n        elseif ($currentCfg.PSObject.Properties.Name -contains 'ParticipatingInCEIP') { $currentCeip = $currentCfg.ParticipatingInCEIP }\n    }\n    $needsCfgUpdate = $false\n    if ($currentInvalid -ne $certAction) { $needsCfgUpdate = $true }\n    if ($currentProxy -ne $proxyPolicy) { $needsCfgUpdate = $true }\n    if ($currentMode -ne $viServerMode) { $needsCfgUpdate = $true }\n    if ($null -ne $currentCeip -and $currentCeip -ne $false) { $needsCfgUpdate = $true }\n\n    if ($needsCfgUpdate) {\n        Set-PowerCLIConfiguration -Scope User `\n            -ParticipateInCEIP $false `\n            -InvalidCertificateAction $certAction `\n            -Confirm:$false `\n            -ProxyPolicy $proxyPolicy `\n            -DefaultVIServerMode $viServerMode `\n            -ErrorAction Stop | Out-Null\n        Write-Host \"PowerCLI configuration updated\"\n    } else {\n        Write-Host \"PowerCLI configuration already matches desired settings (no changes)\"\n    }\n\n    $configSW.Stop(); $perf.config = [math]::Round($configSW.Elapsed.TotalSeconds,3); if ($debug) { Write-Host (\"PERF config={0:n3}s\" -f $perf.config) }\n    \n    # Connect to vCenter\n    Send-Progress -Value 0.4\n    $connectSW = [System.Diagnostics.Stopwatch]::StartNew()\n    Write-Host \"Connecting to vCenter: $vcenterServer\"\n    \n    $securePassword = ConvertTo-SecureString -String $password -AsPlainText -Force\n    $credential = New-Object System.Management.Automation.PSCredential($username, $securePassword)\n    \n    try {\n        $viConnection = Connect-VIServer -Server $vcenterServer -Credential $credential -ErrorAction Stop\n        Write-Host \"Successfully connected to vCenter: $($viConnection.Name)\"\n    }\n    catch {\n        Send-Error -Code 4 -Description \"Failed to connect to vCenter server '$vcenterServer': $($_.Exception.Message)\"\n        exit 1\n    }\n    $connectSW.Stop(); $perf.connect = [math]::Round($connectSW.Elapsed.TotalSeconds,3); if ($debug) { Write-Host (\"PERF connect={0:n3}s\" -f $perf.connect) }\n    \n    Send-Progress -Value 0.5\n    \n    # Execute selected action\n    Write-Host \"Executing action: $selectedAction\"\n    \n    $actionData = @{}\n    $actionSW = [System.Diagnostics.Stopwatch]::StartNew()\n    \n    switch ($selectedAction.ToUpper()) {\n        \"LIST VMS\" {\n            Write-Host \"Retrieving list of all VMs...\"\n            $vms = Get-VM -Server $viConnection | Sort-Object Name\n            \n            $vmList = @()\n            foreach ($vm in $vms) {\n                # Get IP addresses (comma-separated if multiple)\n                $ipAddresses = \"N/A\"\n                if ($vm.Guest.IPAddress -and $vm.Guest.IPAddress.Count -gt 0) {\n                    $ipAddresses = ($vm.Guest.IPAddress -join \", \")\n                }\n                \n                # Calculate uptime\n                $uptime = \"N/A\"\n                if ($vm.PowerState -eq \"PoweredOn\" -and $vm.ExtensionData.Runtime.BootTime) {\n                    $bootTime = $vm.ExtensionData.Runtime.BootTime\n                    $timeSpan = (Get-Date) - $bootTime\n                    if ($timeSpan.Days -gt 0) {\n                        $uptime = \"$($timeSpan.Days)d $($timeSpan.Hours)h $($timeSpan.Minutes)m\"\n                    } elseif ($timeSpan.Hours -gt 0) {\n                        $uptime = \"$($timeSpan.Hours)h $($timeSpan.Minutes)m\"\n                    } else {\n                        $uptime = \"$($timeSpan.Minutes)m\"\n                    }\n                }\n                \n                $vmInfo = @{\n                    Name = $vm.Name\n                    PowerState = $vm.PowerState.ToString()\n                    CPUs = $vm.NumCpu\n                    MemoryGB = [math]::Round($vm.MemoryGB, 2)\n                    UsedSpaceGB = [math]::Round($vm.UsedSpaceGB, 2)\n                    ProvisionedSpaceGB = [math]::Round($vm.ProvisionedSpaceGB, 2)\n                    IPAddresses = $ipAddresses\n                    Uptime = $uptime\n                    GuestOS = $vm.Guest.OSFullName\n                    VMHost = $vm.VMHost.Name\n                    Folder = $vm.Folder.Name\n                    ResourcePool = $vm.ResourcePool.Name\n                    Notes = $vm.Notes\n                }\n                $vmList += $vmInfo\n            }\n            \n            $actionData = @{\n                action = \"ListVMs\"\n                vcenterServer = $vcenterServer\n                vmCount = $vmList.Count\n                vms = $vmList\n            }\n            \n            Write-Host \"Retrieved $($vmList.Count) VMs\"\n        }\n        \n        \"LIST SNAPSHOTS\" {\n            Write-Host \"Retrieving list of VMs with snapshots...\"\n            $allVMs = Get-VM -Server $viConnection | Sort-Object Name\n            \n            $snapshotList = @()\n            foreach ($vm in $allVMs) {\n                $snapshots = Get-Snapshot -VM $vm -ErrorAction SilentlyContinue\n                \n                if ($snapshots) {\n                    foreach ($snapshot in $snapshots) {\n                        $snapshotInfo = @{\n                            VMName = $vm.Name\n                            SnapshotName = $snapshot.Name\n                            Created = $snapshot.Created.ToString(\"yyyy-MM-dd HH:mm:ss\")\n                            SizeGB = [math]::Round($snapshot.SizeGB, 2)\n                            Description = $snapshot.Description\n                            PowerState = $snapshot.PowerState.ToString()\n                        }\n                        $snapshotList += $snapshotInfo\n                    }\n                }\n            }\n            \n            $actionData = @{\n                action = \"ListSnapshots\"\n                vcenterServer = $vcenterServer\n                snapshotCount = $snapshotList.Count\n                vmWithSnapshotsCount = ($snapshotList | Select-Object -ExpandProperty VMName -Unique).Count\n                snapshots = $snapshotList\n            }\n            \n            Write-Host \"Retrieved $($snapshotList.Count) snapshot(s) from $($actionData.vmWithSnapshotsCount) VM(s)\"\n        }\n        \n        \"REBOOT VM\" {\n            # TODO: Implement reboot VM functionality\n            Send-Error -Code 5 -Description \"Action 'Reboot VM' is not yet implemented\"\n            exit 1\n        }\n        \n        \"STOP VM\" {\n            # TODO: Implement stop VM functionality\n            Send-Error -Code 5 -Description \"Action 'Stop VM' is not yet implemented\"\n            exit 1\n        }\n        \n        \"CREATE VM SNAPSHOT\" {\n            Write-Host \"Creating snapshot(s) for VM(s): $vmName...\"\n            \n            # Parse VM names (comma-separated)\n            $vmNames = $vmName -split ',' | ForEach-Object { $_.Trim() } | Where-Object { -not [string]::IsNullOrWhiteSpace($_) }\n            \n            if ($vmNames.Count -eq 0) {\n                Send-Error -Code 9 -Description \"No valid VM names provided. Please specify at least one VM name.\"\n                exit 1\n            }\n            \n            # Generate base snapshot name if not provided\n            $baseSnapshotName = if ([string]::IsNullOrWhiteSpace($snapshotName)) {\n                $timestamp = Get-Date -Format \"yyyyMMddHHmmss\"\n                \"xyOps-VMware-VM-$timestamp\"\n            } else {\n                $snapshotName\n            }\n            \n            # Generate unique identifier based on selection\n            $uniqueIdentifier = \"\"\n            if (-not [string]::IsNullOrWhiteSpace($snapshotUnique) -and $snapshotUnique -ne \"No\") {\n                if ($snapshotUnique -eq \"Unique short UID\") {\n                    # Generate GUID and take first 8 characters\n                    $guid = [System.Guid]::NewGuid().ToString(\"N\")\n                    $uniqueIdentifier = \"-\" + $guid.Substring(0, 8)\n                } elseif ($snapshotUnique -eq \"Timestamp\") {\n                    # Generate timestamp\n                    $timestamp = Get-Date -Format \"yyyyMMddHHmmss\"\n                    $uniqueIdentifier = \"-$timestamp\"\n                }\n            }\n            \n            # Build final snapshot name\n            $finalSnapshotName = $baseSnapshotName + $uniqueIdentifier\n            \n            # Determine snapshot description\n            $finalDescription = if ([string]::IsNullOrWhiteSpace($snapshotDescription)) {\n                if ($uniqueIdentifier -ne \"\") {\n                    \"xyOps-VMware-VM added a custom snapshot with a unique identifier\"\n                } else {\n                    \"xyOps-VMware-VM snapshot\"\n                }\n            } else {\n                $snapshotDescription\n            }\n            \n            Write-Host \"Snapshot Name: $finalSnapshotName\"\n            Write-Host \"Description: $finalDescription\"\n            Write-Host \"Memory Snapshot: $snapshotMemory\"\n            Write-Host \"Target VMs: $($vmNames -join ', ')\"\n            \n            $createdSnapshots = @()\n            $failedSnapshots = @()\n            \n            foreach ($vmNameItem in $vmNames) {\n                try {\n                    Write-Host \"Processing VM: $vmNameItem...\"\n                    \n                    # Get the VM object\n                    $vm = Get-VM -Name $vmNameItem -Server $viConnection -ErrorAction Stop\n                    \n                    # Create the snapshot\n                    Write-Host \"Creating snapshot '$finalSnapshotName' for VM '$vmNameItem'...\"\n                    $snapshot = New-Snapshot -VM $vm -Name $finalSnapshotName -Description $finalDescription -Memory:$snapshotMemory -Quiesce:$false -ErrorAction Stop\n                    \n                    $snapshotInfo = @{\n                        VMName = $vm.Name\n                        SnapshotName = $snapshot.Name\n                        Description = $snapshot.Description\n                        Created = $snapshot.Created.ToString(\"yyyy-MM-dd HH:mm:ss\")\n                        SizeGB = [math]::Round($snapshot.SizeGB, 2)\n                        Memory = $snapshotMemory\n                        Status = \"Success\"\n                        Message = \"Snapshot created successfully\"\n                    }\n                    $createdSnapshots += $snapshotInfo\n                    Write-Host \"Successfully created snapshot '$finalSnapshotName' for VM '$vmNameItem'\"\n                }\n                catch {\n                    $failedInfo = @{\n                        VMName = $vmNameItem\n                        SnapshotName = $finalSnapshotName\n                        Description = $finalDescription\n                        Memory = $snapshotMemory\n                        Status = \"Failed\"\n                        Message = $_.Exception.Message\n                    }\n                    $failedSnapshots += $failedInfo\n                    Write-Host \"Failed to create snapshot for VM '$vmNameItem': $($_.Exception.Message)\"\n                }\n            }\n            \n            $actionData = @{\n                action = \"CreateVMSnapshot\"\n                vcenterServer = $vcenterServer\n                snapshotName = $finalSnapshotName\n                description = $finalDescription\n                memory = $snapshotMemory\n                uniqueIdentifier = $snapshotUnique\n                targetVMs = $vmNames\n                createdCount = $createdSnapshots.Count\n                failedCount = $failedSnapshots.Count\n                totalProcessed = $createdSnapshots.Count + $failedSnapshots.Count\n                createdSnapshots = $createdSnapshots\n                failedSnapshots = $failedSnapshots\n            }\n            \n            Write-Host \"Snapshot creation completed: $($createdSnapshots.Count) created, $($failedSnapshots.Count) failed\"\n        }\n        \n        \"REMOVE SNAPSHOTS BEFORE DATE\" {\n            Write-Host \"Removing snapshots created before $dateInput...\"\n            \n            # Parse the date input with explicit format validation\n            $targetDate = $null\n            $validFormats = @(\n                'yyyy-MM-dd',\n                'yyyy-MM-dd HH:mm:ss',\n                'MM/dd/yyyy',\n                'dd/MM/yyyy',\n                'yyyy/MM/dd'\n            )\n            \n            # Try parsing with specific formats first\n            $parseSuccess = $false\n            foreach ($format in $validFormats) {\n                try {\n                    $targetDate = [DateTime]::ParseExact($dateInput, $format, $null)\n                    $parseSuccess = $true\n                    Write-Host \"Target date parsed using format '$format': $($targetDate.ToString('yyyy-MM-dd HH:mm:ss'))\"\n                    break\n                }\n                catch {\n                    # Try next format\n                }\n            }\n            \n            # If specific formats failed, try general parsing as fallback\n            if (-not $parseSuccess) {\n                try {\n                    $targetDate = [DateTime]::Parse($dateInput)\n                    $parseSuccess = $true\n                    Write-Host \"Target date parsed: $($targetDate.ToString('yyyy-MM-dd HH:mm:ss'))\"\n                }\n                catch {\n                    Send-Error -Code 7 -Description \"Invalid date format: '$dateInput'. Please use one of these formats: yyyy-MM-dd, yyyy-MM-dd HH:mm:ss, MM/dd/yyyy, dd/MM/yyyy, or yyyy/MM/dd\"\n                    exit 1\n                }\n            }\n            \n            $allVMs = Get-VM -Server $viConnection | Sort-Object Name\n            \n            $removedSnapshots = @()\n            $failedRemovals = @()\n            $skippedSnapshots = @()\n            \n            foreach ($vm in $allVMs) {\n                $snapshots = Get-Snapshot -VM $vm -ErrorAction SilentlyContinue\n                \n                if ($snapshots) {\n                    foreach ($snapshot in $snapshots) {\n                        if ($snapshot.Created -lt $targetDate) {\n                            # Check if snapshot matches exception criteria\n                            $shouldSkip = Test-SnapshotException -SnapshotName $snapshot.Name -SnapshotDescription $snapshot.Description -ExceptionList $snapshotRemovalException\n                            \n                            if ($shouldSkip) {\n                                Write-Host \"Skipping snapshot '$($snapshot.Name)' from VM '$($vm.Name)' (matches exception criteria)\"\n                                $skippedInfo = @{\n                                    VMName = $vm.Name\n                                    SnapshotName = $snapshot.Name\n                                    Created = $snapshot.Created.ToString(\"yyyy-MM-dd HH:mm:ss\")\n                                    SizeGB = [math]::Round($snapshot.SizeGB, 2)\n                                    Reason = \"Matches exception criteria\"\n                                }\n                                $skippedSnapshots += $skippedInfo\n                                continue\n                            }\n                            \n                            Write-Host \"Removing snapshot '$($snapshot.Name)' from VM '$($vm.Name)' (Created: $($snapshot.Created.ToString('yyyy-MM-dd HH:mm:ss')))...\"\n                            \n                            try {\n                                Remove-Snapshot -Snapshot $snapshot -Confirm:$false -ErrorAction Stop\n                                \n                                $removedInfo = @{\n                                    VMName = $vm.Name\n                                    SnapshotName = $snapshot.Name\n                                    Created = $snapshot.Created.ToString(\"yyyy-MM-dd HH:mm:ss\")\n                                    SizeGB = [math]::Round($snapshot.SizeGB, 2)\n                                    Status = \"Success\"\n                                    Message = \"Successfully removed\"\n                                }\n                                $removedSnapshots += $removedInfo\n                                Write-Host \"Successfully removed snapshot '$($snapshot.Name)' from VM '$($vm.Name)'\"\n                            }\n                            catch {\n                                $failedInfo = @{\n                                    VMName = $vm.Name\n                                    SnapshotName = $snapshot.Name\n                                    Created = $snapshot.Created.ToString(\"yyyy-MM-dd HH:mm:ss\")\n                                    SizeGB = [math]::Round($snapshot.SizeGB, 2)\n                                    Status = \"Failed\"\n                                    Message = $_.Exception.Message\n                                }\n                                $failedRemovals += $failedInfo\n                                Write-Host \"Failed to remove snapshot '$($snapshot.Name)' from VM '$($vm.Name)': $($_.Exception.Message)\"\n                            }\n                        }\n                    }\n                }\n            }\n            \n            $actionData = @{\n                action = \"RemoveSnapshotsBeforeDate\"\n                vcenterServer = $vcenterServer\n                targetDate = $targetDate.ToString(\"yyyy-MM-dd HH:mm:ss\")\n                removedCount = $removedSnapshots.Count\n                failedCount = $failedRemovals.Count\n                skippedCount = $skippedSnapshots.Count\n                totalProcessed = $removedSnapshots.Count + $failedRemovals.Count\n                removedSnapshots = $removedSnapshots\n                failedRemovals = $failedRemovals\n                skippedSnapshots = $skippedSnapshots\n            }\n            \n            Write-Host \"Snapshot removal completed: $($removedSnapshots.Count) removed, $($failedRemovals.Count) failed, $($skippedSnapshots.Count) skipped\"\n        }\n        \n        \"REMOVE SNAPSHOTS BEFORE NUMBER OF WEEKS\" {\n            Write-Host \"Removing snapshots older than $numberOfWeeks weeks...\"\n            \n            # Validate numberOfWeeks is a valid number\n            try {\n                $weeksValue = [int]$numberOfWeeks\n                if ($weeksValue -le 0) {\n                    Send-Error -Code 8 -Description \"Invalid number of weeks: '$numberOfWeeks'. Please provide a positive number.\"\n                    exit 1\n                }\n            }\n            catch {\n                Send-Error -Code 8 -Description \"Invalid number of weeks: '$numberOfWeeks'. Please provide a valid positive integer.\"\n                exit 1\n            }\n            \n            # Calculate the target date (current date minus number of weeks)\n            $targetDate = (Get-Date).AddDays(-($weeksValue * 7))\n            Write-Host \"Target date calculated: $($targetDate.ToString('yyyy-MM-dd HH:mm:ss')) (snapshots older than $weeksValue week(s) will be removed)\"\n            \n            $allVMs = Get-VM -Server $viConnection | Sort-Object Name\n            \n            $removedSnapshots = @()\n            $failedRemovals = @()\n            $skippedSnapshots = @()\n            \n            foreach ($vm in $allVMs) {\n                $snapshots = Get-Snapshot -VM $vm -ErrorAction SilentlyContinue\n                \n                if ($snapshots) {\n                    foreach ($snapshot in $snapshots) {\n                        if ($snapshot.Created -lt $targetDate) {\n                            # Check if snapshot matches exception criteria\n                            $shouldSkip = Test-SnapshotException -SnapshotName $snapshot.Name -SnapshotDescription $snapshot.Description -ExceptionList $snapshotRemovalException\n                            \n                            if ($shouldSkip) {\n                                Write-Host \"Skipping snapshot '$($snapshot.Name)' from VM '$($vm.Name)' (matches exception criteria)\"\n                                $ageInDays = [math]::Round(((Get-Date) - $snapshot.Created).TotalDays, 1)\n                                $skippedInfo = @{\n                                    VMName = $vm.Name\n                                    SnapshotName = $snapshot.Name\n                                    Created = $snapshot.Created.ToString(\"yyyy-MM-dd HH:mm:ss\")\n                                    AgeDays = $ageInDays\n                                    SizeGB = [math]::Round($snapshot.SizeGB, 2)\n                                    Reason = \"Matches exception criteria\"\n                                }\n                                $skippedSnapshots += $skippedInfo\n                                continue\n                            }\n                            \n                            $ageInDays = [math]::Round(((Get-Date) - $snapshot.Created).TotalDays, 1)\n                            Write-Host \"Removing snapshot '$($snapshot.Name)' from VM '$($vm.Name)' (Created: $($snapshot.Created.ToString('yyyy-MM-dd HH:mm:ss')), Age: $ageInDays days)...\"\n                            \n                            try {\n                                Remove-Snapshot -Snapshot $snapshot -Confirm:$false -ErrorAction Stop\n                                \n                                $removedInfo = @{\n                                    VMName = $vm.Name\n                                    SnapshotName = $snapshot.Name\n                                    Created = $snapshot.Created.ToString(\"yyyy-MM-dd HH:mm:ss\")\n                                    AgeDays = $ageInDays\n                                    SizeGB = [math]::Round($snapshot.SizeGB, 2)\n                                    Status = \"Success\"\n                                    Message = \"Successfully removed\"\n                                }\n                                $removedSnapshots += $removedInfo\n                                Write-Host \"Successfully removed snapshot '$($snapshot.Name)' from VM '$($vm.Name)'\"\n                            }\n                            catch {\n                                $failedInfo = @{\n                                    VMName = $vm.Name\n                                    SnapshotName = $snapshot.Name\n                                    Created = $snapshot.Created.ToString(\"yyyy-MM-dd HH:mm:ss\")\n                                    AgeDays = $ageInDays\n                                    SizeGB = [math]::Round($snapshot.SizeGB, 2)\n                                    Status = \"Failed\"\n                                    Message = $_.Exception.Message\n                                }\n                                $failedRemovals += $failedInfo\n                                Write-Host \"Failed to remove snapshot '$($snapshot.Name)' from VM '$($vm.Name)': $($_.Exception.Message)\"\n                            }\n                        }\n                    }\n                }\n            }\n            \n            $actionData = @{\n                action = \"RemoveVMSnapshotsBeforeNumberOfWeeks\"\n                vcenterServer = $vcenterServer\n                numberOfWeeks = $weeksValue\n                targetDate = $targetDate.ToString(\"yyyy-MM-dd HH:mm:ss\")\n                removedCount = $removedSnapshots.Count\n                failedCount = $failedRemovals.Count\n                skippedCount = $skippedSnapshots.Count\n                totalProcessed = $removedSnapshots.Count + $failedRemovals.Count\n                removedSnapshots = $removedSnapshots\n                failedRemovals = $failedRemovals\n                skippedSnapshots = $skippedSnapshots\n            }\n            \n            Write-Host \"Snapshot removal completed: $($removedSnapshots.Count) removed, $($failedRemovals.Count) failed, $($skippedSnapshots.Count) skipped\"\n        }\n        \n        \"REMOVE ALL SNAPSHOTS\" {\n            Write-Host \"Removing ALL snapshots from all VMs...\"\n            \n            $allVMs = Get-VM -Server $viConnection | Sort-Object Name\n            \n            $removedSnapshots = @()\n            $failedRemovals = @()\n            $skippedSnapshots = @()\n            \n            foreach ($vm in $allVMs) {\n                $snapshots = Get-Snapshot -VM $vm -ErrorAction SilentlyContinue\n                \n                if ($snapshots) {\n                    foreach ($snapshot in $snapshots) {\n                        # Check if snapshot matches exception criteria\n                        $shouldSkip = Test-SnapshotException -SnapshotName $snapshot.Name -SnapshotDescription $snapshot.Description -ExceptionList $snapshotRemovalException\n                        \n                        if ($shouldSkip) {\n                            Write-Host \"Skipping snapshot '$($snapshot.Name)' from VM '$($vm.Name)' (matches exception criteria)\"\n                            $ageInDays = [math]::Round(((Get-Date) - $snapshot.Created).TotalDays, 1)\n                            $skippedInfo = @{\n                                VMName = $vm.Name\n                                SnapshotName = $snapshot.Name\n                                Created = $snapshot.Created.ToString(\"yyyy-MM-dd HH:mm:ss\")\n                                AgeDays = $ageInDays\n                                SizeGB = [math]::Round($snapshot.SizeGB, 2)\n                                Reason = \"Matches exception criteria\"\n                            }\n                            $skippedSnapshots += $skippedInfo\n                            continue\n                        }\n                        \n                        $ageInDays = [math]::Round(((Get-Date) - $snapshot.Created).TotalDays, 1)\n                        Write-Host \"Removing snapshot '$($snapshot.Name)' from VM '$($vm.Name)' (Created: $($snapshot.Created.ToString('yyyy-MM-dd HH:mm:ss')), Age: $ageInDays days)...\"\n                        \n                        try {\n                            Remove-Snapshot -Snapshot $snapshot -Confirm:$false -ErrorAction Stop\n                            \n                            $removedInfo = @{\n                                VMName = $vm.Name\n                                SnapshotName = $snapshot.Name\n                                Created = $snapshot.Created.ToString(\"yyyy-MM-dd HH:mm:ss\")\n                                AgeDays = $ageInDays\n                                SizeGB = [math]::Round($snapshot.SizeGB, 2)\n                                Status = \"Success\"\n                                Message = \"Successfully removed\"\n                            }\n                            $removedSnapshots += $removedInfo\n                            Write-Host \"Successfully removed snapshot '$($snapshot.Name)' from VM '$($vm.Name)'\"\n                        }\n                        catch {\n                            $failedInfo = @{\n                                VMName = $vm.Name\n                                SnapshotName = $snapshot.Name\n                                Created = $snapshot.Created.ToString(\"yyyy-MM-dd HH:mm:ss\")\n                                AgeDays = $ageInDays\n                                SizeGB = [math]::Round($snapshot.SizeGB, 2)\n                                Status = \"Failed\"\n                                Message = $_.Exception.Message\n                            }\n                            $failedRemovals += $failedInfo\n                            Write-Host \"Failed to remove snapshot '$($snapshot.Name)' from VM '$($vm.Name)': $($_.Exception.Message)\"\n                        }\n                    }\n                }\n            }\n            \n            $actionData = @{\n                action = \"RemoveAllSnapshots\"\n                vcenterServer = $vcenterServer\n                removedCount = $removedSnapshots.Count\n                failedCount = $failedRemovals.Count\n                skippedCount = $skippedSnapshots.Count\n                totalProcessed = $removedSnapshots.Count + $failedRemovals.Count\n                removedSnapshots = $removedSnapshots\n                failedRemovals = $failedRemovals\n                skippedSnapshots = $skippedSnapshots\n            }\n            \n            Write-Host \"Snapshot removal completed: $($removedSnapshots.Count) removed, $($failedRemovals.Count) failed, $($skippedSnapshots.Count) skipped\"\n        }\n        \n        \"REMOVE SNAPSHOTS CONTAINING SPECIFIC TEXT\" {\n            Write-Host \"Removing snapshots containing text: '$snapshotName'...\"\n            \n            $allVMs = Get-VM -Server $viConnection | Sort-Object Name\n            \n            $removedSnapshots = @()\n            $failedRemovals = @()\n            $skippedSnapshots = @()\n            \n            foreach ($vm in $allVMs) {\n                $snapshots = Get-Snapshot -VM $vm -ErrorAction SilentlyContinue\n                \n                if ($snapshots) {\n                    foreach ($snapshot in $snapshots) {\n                        # Check if snapshot name contains the search text (case-insensitive)\n                        if ($snapshot.Name -like \"*$snapshotName*\") {\n                            # Check if snapshot matches exception criteria\n                            $shouldSkip = Test-SnapshotException -SnapshotName $snapshot.Name -SnapshotDescription $snapshot.Description -ExceptionList $snapshotRemovalException\n                            \n                            if ($shouldSkip) {\n                                Write-Host \"Skipping snapshot '$($snapshot.Name)' from VM '$($vm.Name)' (matches exception criteria)\"\n                                $ageInDays = [math]::Round(((Get-Date) - $snapshot.Created).TotalDays, 1)\n                                $skippedInfo = @{\n                                    VMName = $vm.Name\n                                    SnapshotName = $snapshot.Name\n                                    Created = $snapshot.Created.ToString(\"yyyy-MM-dd HH:mm:ss\")\n                                    AgeDays = $ageInDays\n                                    SizeGB = [math]::Round($snapshot.SizeGB, 2)\n                                    Reason = \"Matches exception criteria\"\n                                }\n                                $skippedSnapshots += $skippedInfo\n                                continue\n                            }\n                            \n                            $ageInDays = [math]::Round(((Get-Date) - $snapshot.Created).TotalDays, 1)\n                            Write-Host \"Removing snapshot '$($snapshot.Name)' from VM '$($vm.Name)' (matches text: '$snapshotName')...\"\n                            \n                            try {\n                                Remove-Snapshot -Snapshot $snapshot -Confirm:$false -ErrorAction Stop\n                                \n                                $removedInfo = @{\n                                    VMName = $vm.Name\n                                    SnapshotName = $snapshot.Name\n                                    Created = $snapshot.Created.ToString(\"yyyy-MM-dd HH:mm:ss\")\n                                    AgeDays = $ageInDays\n                                    SizeGB = [math]::Round($snapshot.SizeGB, 2)\n                                    Status = \"Success\"\n                                    Message = \"Successfully removed\"\n                                }\n                                $removedSnapshots += $removedInfo\n                                Write-Host \"Successfully removed snapshot '$($snapshot.Name)' from VM '$($vm.Name)'\"\n                            }\n                            catch {\n                                $failedInfo = @{\n                                    VMName = $vm.Name\n                                    SnapshotName = $snapshot.Name\n                                    Created = $snapshot.Created.ToString(\"yyyy-MM-dd HH:mm:ss\")\n                                    AgeDays = $ageInDays\n                                    SizeGB = [math]::Round($snapshot.SizeGB, 2)\n                                    Status = \"Failed\"\n                                    Message = $_.Exception.Message\n                                }\n                                $failedRemovals += $failedInfo\n                                Write-Host \"Failed to remove snapshot '$($snapshot.Name)' from VM '$($vm.Name)': $($_.Exception.Message)\"\n                            }\n                        }\n                    }\n                }\n            }\n            \n            $actionData = @{\n                action = \"RemoveSnapshotsContainingText\"\n                vcenterServer = $vcenterServer\n                searchText = $snapshotName\n                removedCount = $removedSnapshots.Count\n                failedCount = $failedRemovals.Count\n                skippedCount = $skippedSnapshots.Count\n                totalProcessed = $removedSnapshots.Count + $failedRemovals.Count\n                removedSnapshots = $removedSnapshots\n                failedRemovals = $failedRemovals\n                skippedSnapshots = $skippedSnapshots\n            }\n            \n            Write-Host \"Snapshot removal completed: $($removedSnapshots.Count) removed, $($failedRemovals.Count) failed, $($skippedSnapshots.Count) skipped\"\n        }\n        \n        default {\n            Send-Error -Code 6 -Description \"Unknown action: $selectedAction. Valid actions are: ListVMs, ListSnapshots, CreateVMSnapshot, RemoveSnapshotsBeforeDate, RemoveSnapshotsBeforeNumberOfWeeks, RemoveAllSnapshots, RemoveSnapshotsContainingSpecificText, RebootVM, StopVM\"\n            exit 1\n        }\n    }\n    $actionSW.Stop(); $perf.action = [math]::Round($actionSW.Elapsed.TotalSeconds,3); if ($debug) { Write-Host (\"PERF action={0:n3}s\" -f $perf.action) }\n    \n    Send-Progress -Value 0.7\n    \n    # Build Markdown output for display in xyOps GUI\n    Write-Host \"Building Markdown output for display...\"\n    $markdownContent = \"# VMware VM Operations Report`n`n\"\n    $markdownContent += \"## Operation Details`n`n\"\n    $markdownContent += \"| Property | Value |`n\"\n    $markdownContent += \"|----------|-------|`n\"\n    $markdownContent += \"| **Action** | $($actionData.action) |`n\"\n    $markdownContent += \"| **vCenter Server** | $($actionData.vcenterServer) |`n\"\n    $markdownContent += \"| **Timestamp** | $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss') |`n\"\n    $markdownContent += \"`n\"\n    \n    if ($selectedAction.ToUpper() -eq \"LIST SNAPSHOTS\") {\n        # Display snapshots grouped by VM\n        if ($actionData.snapshots.Count -gt 0) {\n            $markdownContent += \"## VM Snapshots Overview`n`n\"\n            $markdownContent += \"**Total Snapshots**: $($actionData.snapshotCount) | **VMs with Snapshots**: $($actionData.vmWithSnapshotsCount)`n`n\"\n            $markdownContent += \"## Snapshot Details`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Size (GB) | Power State | Description |`n\"\n            $markdownContent += \"|---------|---------------|---------|-----------|-------------|-------------|`n\"\n            \n            foreach ($snapshot in $actionData.snapshots) {\n                $desc = if ([string]::IsNullOrWhiteSpace($snapshot.Description)) { \"-\" } else { $snapshot.Description }\n                $markdownContent += \"| **$($snapshot.VMName)** | $($snapshot.SnapshotName) | $($snapshot.Created) | $($snapshot.SizeGB) | $($snapshot.PowerState) | $desc |`n\"\n            }\n            $markdownContent += \"`n\"\n        } else {\n            $markdownContent += \"## No Snapshots Found`n`n\"\n            $markdownContent += \"There are no snapshots in the vCenter environment.`n`n\"\n        }\n    } elseif ($selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS BEFORE DATE\") {\n        # Display snapshot removal results\n        $markdownContent += \"## Snapshot Removal Summary`n`n\"\n        $markdownContent += \"**Target Date**: $($actionData.targetDate)`n`n\"\n        $markdownContent += \"**Removed**: $($actionData.removedCount) | **Failed**: $($actionData.failedCount) | **Skipped**: $($actionData.skippedCount) | **Total Processed**: $($actionData.totalProcessed)`n`n\"\n        \n        if ($actionData.removedSnapshots.Count -gt 0) {\n            $markdownContent += \"## Successfully Removed Snapshots ($($actionData.removedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Size (GB) |`n\"\n            $markdownContent += \"|---------|---------------|---------|-----------|`n\"\n            \n            foreach ($snapshot in $actionData.removedSnapshots) {\n                $markdownContent += \"| **$($snapshot.VMName)** | $($snapshot.SnapshotName) | $($snapshot.Created) | $($snapshot.SizeGB) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.skippedSnapshots.Count -gt 0) {\n            $markdownContent += \"## Skipped Snapshots ($($actionData.skippedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Size (GB) | Reason |`n\"\n            $markdownContent += \"|---------|---------------|---------|-----------|--------|`n\"\n            \n            foreach ($skipped in $actionData.skippedSnapshots) {\n                $markdownContent += \"| **$($skipped.VMName)** | $($skipped.SnapshotName) | $($skipped.Created) | $($skipped.SizeGB) | $($skipped.Reason) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.failedRemovals.Count -gt 0) {\n            $markdownContent += \"## Failed Removals ($($actionData.failedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Size (GB) | Error Message |`n\"\n            $markdownContent += \"|---------|---------------|---------|-----------|---------------|`n\"\n            \n            foreach ($failed in $actionData.failedRemovals) {\n                $markdownContent += \"| **$($failed.VMName)** | $($failed.SnapshotName) | $($failed.Created) | $($failed.SizeGB) | $($failed.Message) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.removedCount -eq 0 -and $actionData.failedCount -eq 0) {\n            $markdownContent += \"## No Snapshots Found`n`n\"\n            $markdownContent += \"No snapshots were found before the target date $($actionData.targetDate).`n`n\"\n        }\n    } elseif ($selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS BEFORE NUMBER OF WEEKS\") {\n        # Display snapshot removal results for weeks-based removal\n        $markdownContent += \"## Snapshot Removal Summary`n`n\"\n        $markdownContent += \"**Number of Weeks**: $($actionData.numberOfWeeks) week(s)`n`n\"\n        $markdownContent += \"**Target Date**: $($actionData.targetDate) (snapshots older than this are removed)`n`n\"\n        $markdownContent += \"**Removed**: $($actionData.removedCount) | **Failed**: $($actionData.failedCount) | **Skipped**: $($actionData.skippedCount) | **Total Processed**: $($actionData.totalProcessed)`n`n\"\n        \n        if ($actionData.removedSnapshots.Count -gt 0) {\n            $markdownContent += \"## Successfully Removed Snapshots ($($actionData.removedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Age (Days) | Size (GB) |`n\"\n            $markdownContent += \"|---------|---------------|---------|------------|-----------|`n\"\n            \n            foreach ($snapshot in $actionData.removedSnapshots) {\n                $markdownContent += \"| **$($snapshot.VMName)** | $($snapshot.SnapshotName) | $($snapshot.Created) | $($snapshot.AgeDays) | $($snapshot.SizeGB) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.skippedSnapshots.Count -gt 0) {\n            $markdownContent += \"## Skipped Snapshots ($($actionData.skippedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Age (Days) | Size (GB) | Reason |`n\"\n            $markdownContent += \"|---------|---------------|---------|------------|-----------|--------|`n\"\n            \n            foreach ($skipped in $actionData.skippedSnapshots) {\n                $markdownContent += \"| **$($skipped.VMName)** | $($skipped.SnapshotName) | $($skipped.Created) | $($skipped.AgeDays) | $($skipped.SizeGB) | $($skipped.Reason) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.failedRemovals.Count -gt 0) {\n            $markdownContent += \"## Failed Removals ($($actionData.failedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Age (Days) | Size (GB) | Error Message |`n\"\n            $markdownContent += \"|---------|---------------|---------|------------|-----------|---------------|`n\"\n            \n            foreach ($failed in $actionData.failedRemovals) {\n                $markdownContent += \"| **$($failed.VMName)** | $($failed.SnapshotName) | $($failed.Created) | $($failed.AgeDays) | $($failed.SizeGB) | $($failed.Message) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.removedCount -eq 0 -and $actionData.failedCount -eq 0) {\n            $markdownContent += \"## No Snapshots Found`n`n\"\n            $markdownContent += \"No snapshots older than $($actionData.numberOfWeeks) week(s) were found.`n`n\"\n        }\n    } elseif ($selectedAction.ToUpper() -eq \"REMOVE ALL SNAPSHOTS\") {\n        # Display snapshot removal results for all snapshots\n        $markdownContent += \"## Snapshot Removal Summary`n`n\"\n        $markdownContent += \"**Action**: Remove ALL Snapshots`n`n\"\n        $markdownContent += \"**Removed**: $($actionData.removedCount) | **Failed**: $($actionData.failedCount) | **Skipped**: $($actionData.skippedCount) | **Total Processed**: $($actionData.totalProcessed)`n`n\"\n        \n        if ($actionData.removedSnapshots.Count -gt 0) {\n            $markdownContent += \"## Successfully Removed Snapshots ($($actionData.removedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Age (Days) | Size (GB) |`n\"\n            $markdownContent += \"|---------|---------------|---------|------------|-----------|`n\"\n            \n            foreach ($snapshot in $actionData.removedSnapshots) {\n                $markdownContent += \"| **$($snapshot.VMName)** | $($snapshot.SnapshotName) | $($snapshot.Created) | $($snapshot.AgeDays) | $($snapshot.SizeGB) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.skippedSnapshots.Count -gt 0) {\n            $markdownContent += \"## Skipped Snapshots ($($actionData.skippedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Age (Days) | Size (GB) | Reason |`n\"\n            $markdownContent += \"|---------|---------------|---------|------------|-----------|--------|`n\"\n            \n            foreach ($skipped in $actionData.skippedSnapshots) {\n                $markdownContent += \"| **$($skipped.VMName)** | $($skipped.SnapshotName) | $($skipped.Created) | $($skipped.AgeDays) | $($skipped.SizeGB) | $($skipped.Reason) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.failedRemovals.Count -gt 0) {\n            $markdownContent += \"## Failed Removals ($($actionData.failedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Age (Days) | Size (GB) | Error Message |`n\"\n            $markdownContent += \"|---------|---------------|---------|------------|-----------|---------------|`n\"\n            \n            foreach ($failed in $actionData.failedRemovals) {\n                $markdownContent += \"| **$($failed.VMName)** | $($failed.SnapshotName) | $($failed.Created) | $($failed.AgeDays) | $($failed.SizeGB) | $($failed.Message) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.removedCount -eq 0 -and $actionData.failedCount -eq 0) {\n            $markdownContent += \"## No Snapshots Found`n`n\"\n            $markdownContent += \"No snapshots were found in the vCenter environment.`n`n\"\n        }\n    } elseif ($selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS CONTAINING SPECIFIC TEXT\") {\n        # Display snapshot removal results for text-based search\n        $markdownContent += \"## Snapshot Removal Summary`n`n\"\n        $markdownContent += \"**Search Text**: $($actionData.searchText)`n`n\"\n        $markdownContent += \"**Removed**: $($actionData.removedCount) | **Failed**: $($actionData.failedCount) | **Skipped**: $($actionData.skippedCount) | **Total Processed**: $($actionData.totalProcessed)`n`n\"\n        \n        if ($actionData.removedSnapshots.Count -gt 0) {\n            $markdownContent += \"## Successfully Removed Snapshots ($($actionData.removedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Age (Days) | Size (GB) |`n\"\n            $markdownContent += \"|---------|---------------|---------|------------|-----------|`n\"\n            \n            foreach ($snapshot in $actionData.removedSnapshots) {\n                $markdownContent += \"| **$($snapshot.VMName)** | $($snapshot.SnapshotName) | $($snapshot.Created) | $($snapshot.AgeDays) | $($snapshot.SizeGB) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.skippedSnapshots.Count -gt 0) {\n            $markdownContent += \"## Skipped Snapshots ($($actionData.skippedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Age (Days) | Size (GB) | Reason |`n\"\n            $markdownContent += \"|---------|---------------|---------|------------|-----------|--------|`n\"\n            \n            foreach ($skipped in $actionData.skippedSnapshots) {\n                $markdownContent += \"| **$($skipped.VMName)** | $($skipped.SnapshotName) | $($skipped.Created) | $($skipped.AgeDays) | $($skipped.SizeGB) | $($skipped.Reason) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.failedRemovals.Count -gt 0) {\n            $markdownContent += \"## Failed Removals ($($actionData.failedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Age (Days) | Size (GB) | Error Message |`n\"\n            $markdownContent += \"|---------|---------------|---------|------------|-----------|---------------|`n\"\n            \n            foreach ($failed in $actionData.failedRemovals) {\n                $markdownContent += \"| **$($failed.VMName)** | $($failed.SnapshotName) | $($failed.Created) | $($failed.AgeDays) | $($failed.SizeGB) | $($failed.Message) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.removedCount -eq 0 -and $actionData.failedCount -eq 0) {\n            $markdownContent += \"## No Snapshots Found`n`n\"\n            $markdownContent += \"No snapshots containing the text '$($actionData.searchText)' were found.`n`n\"\n        }\n    } elseif ($selectedAction.ToUpper() -eq \"CREATE VM SNAPSHOT\") {\n        # Display snapshot creation results\n        $markdownContent += \"## Snapshot Creation Summary`n`n\"\n        $markdownContent += \"**Snapshot Name**: $($actionData.snapshotName)`n`n\"\n        $markdownContent += \"**Description**: $($actionData.description)`n`n\"\n        $markdownContent += \"**Memory Snapshot**: $($actionData.memory)`n`n\"\n        $markdownContent += \"**Unique Identifier**: $($actionData.uniqueIdentifier)`n`n\"\n        $markdownContent += \"**Created**: $($actionData.createdCount) | **Failed**: $($actionData.failedCount) | **Total Processed**: $($actionData.totalProcessed)`n`n\"\n        \n        if ($actionData.createdSnapshots.Count -gt 0) {\n            $markdownContent += \"## Successfully Created Snapshots ($($actionData.createdCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Description | Created | Size (GB) | Memory |`n\"\n            $markdownContent += \"|---------|---------------|-------------|---------|-----------|--------|`n\"\n            \n            foreach ($snapshot in $actionData.createdSnapshots) {\n                $memoryIcon = if ($snapshot.Memory) { \"\" } else { \"\" }\n                $markdownContent += \"| **$($snapshot.VMName)** | $($snapshot.SnapshotName) | $($snapshot.Description) | $($snapshot.Created) | $($snapshot.SizeGB) | $memoryIcon |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.failedSnapshots.Count -gt 0) {\n            $markdownContent += \"## Failed Snapshot Creations ($($actionData.failedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Error Message |`n\"\n            $markdownContent += \"|---------|---------------|---------------|`n\"\n            \n            foreach ($failed in $actionData.failedSnapshots) {\n                $markdownContent += \"| **$($failed.VMName)** | $($failed.SnapshotName) | $($failed.Message) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.createdCount -eq 0 -and $actionData.failedCount -gt 0) {\n            $markdownContent += \"## No Snapshots Created`n`n\"\n            $markdownContent += \"All snapshot creation attempts failed. Please check the error messages above.`n`n\"\n        }\n    } elseif ($selectedAction.ToUpper() -eq \"LIST VMS\") {\n        # Separate VMs by power state\n        $poweredOnVMs = $actionData.vms | Where-Object { $_.PowerState -eq \"PoweredOn\" }\n        $poweredOffVMs = $actionData.vms | Where-Object { $_.PowerState -eq \"PoweredOff\" }\n        \n        # PoweredOn VMs table\n        if ($poweredOnVMs.Count -gt 0) {\n            $markdownContent += \"## Powered On Virtual Machines ($($poweredOnVMs.Count))`n`n\"\n            $markdownContent += \"| Name | IP Addresses | Uptime | CPUs | Memory (GB) | Used Space (GB) | Guest OS | Host |`n\"\n            $markdownContent += \"|------|--------------|--------|------|-------------|-----------------|----------|------|`n\"\n            \n            foreach ($vm in $poweredOnVMs) {\n                # Format IP addresses with line breaks for Markdown\n                $ipFormatted = if ($vm.IPAddresses -ne \"N/A\" -and $vm.IPAddresses -match \",\") {\n                    ($vm.IPAddresses -split \", \") -join \"<br>\"\n                } else {\n                    $vm.IPAddresses\n                }\n                $markdownContent += \"| **$($vm.Name)** | $ipFormatted | $($vm.Uptime) | $($vm.CPUs) | $($vm.MemoryGB) | $($vm.UsedSpaceGB) | $($vm.GuestOS) | $($vm.VMHost) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        # PoweredOff VMs table\n        if ($poweredOffVMs.Count -gt 0) {\n            $markdownContent += \"## Powered Off Virtual Machines ($($poweredOffVMs.Count))`n`n\"\n            $markdownContent += \"| Name | CPUs | Memory (GB) | Used Space (GB) | Guest OS | Host |`n\"\n            $markdownContent += \"|------|------|-------------|-----------------|----------|------|`n\"\n            \n            foreach ($vm in $poweredOffVMs) {\n                $markdownContent += \"| **$($vm.Name)** | $($vm.CPUs) | $($vm.MemoryGB) | $($vm.UsedSpaceGB) | $($vm.GuestOS) | $($vm.VMHost) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n    }\n    \n    $outputSW = [System.Diagnostics.Stopwatch]::StartNew()\n\n    # Always output the Markdown for display in xyOps GUI\n    if ($selectedAction.ToUpper() -eq \"LIST SNAPSHOTS\") {\n        $caption = \"vCenter: $($actionData.vcenterServer) | Action: $($actionData.action) | Snapshots: $($actionData.snapshotCount) from $($actionData.vmWithSnapshotsCount) VM(s)\"\n    } elseif ($selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS BEFORE DATE\") {\n        $caption = \"vCenter: $($actionData.vcenterServer) | Action: $($actionData.action) | Removed: $($actionData.removedCount), Failed: $($actionData.failedCount), Skipped: $($actionData.skippedCount)\"\n    } elseif ($selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS BEFORE NUMBER OF WEEKS\") {\n        $caption = \"vCenter: $($actionData.vcenterServer) | Action: $($actionData.action) | Weeks: $($actionData.numberOfWeeks) | Removed: $($actionData.removedCount), Failed: $($actionData.failedCount), Skipped: $($actionData.skippedCount)\"\n    } elseif ($selectedAction.ToUpper() -eq \"REMOVE ALL SNAPSHOTS\") {\n        $caption = \"vCenter: $($actionData.vcenterServer) | Action: $($actionData.action) | Removed: $($actionData.removedCount), Failed: $($actionData.failedCount), Skipped: $($actionData.skippedCount)\"\n    } elseif ($selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS CONTAINING SPECIFIC TEXT\") {\n        $caption = \"vCenter: $($actionData.vcenterServer) | Action: $($actionData.action) | Search: '$($actionData.searchText)' | Removed: $($actionData.removedCount), Failed: $($actionData.failedCount), Skipped: $($actionData.skippedCount)\"\n    } elseif ($selectedAction.ToUpper() -eq \"CREATE VM SNAPSHOT\") {\n        $caption = \"vCenter: $($actionData.vcenterServer) | Action: $($actionData.action) | Created: $($actionData.createdCount), Failed: $($actionData.failedCount)\"\n    } else {\n        $caption = \"vCenter: $($actionData.vcenterServer) | Action: $($actionData.action) | VMs: $($actionData.vmCount)\"\n    }\n    Write-Output-JSON @{\n        xy = 1\n        markdown = @{\n            title = \"VMware VM Operations Report\"\n            content = $markdownContent\n            caption = $caption\n        }\n    }\n    \n    Send-Progress -Value 0.9\n    \n    # Output data in requested format\n    Write-Host \"Outputting data in $exportFormat format...\"\n    \n    switch ($exportFormat) {\n        \"JSON\" {\n            if ($exportToFile) {\n                # Generate filename with timestamp\n                $timestamp = Get-Date -Format \"yyyyMMdd_HHmmss\"\n                $filename = \"vmware_vm_$($selectedAction.ToLower())_$timestamp.json\"\n                \n                # Write JSON to file\n                $actionData | ConvertTo-Json -Depth 100 | Out-File -FilePath $filename -Encoding UTF8\n                Write-Host \"JSON file created: $filename\"\n                \n                # Output JSON data AND file reference\n                $jsonData = @{\n                    xy = 1\n                    data = $actionData\n                    files = @(\n                        @{\n                            path = $filename\n                            name = $filename\n                        }\n                    )\n                }\n                Write-Output-JSON $jsonData\n            } else {\n                # Output JSON data only (no file)\n                $jsonData = @{\n                    xy = 1\n                    data = $actionData\n                }\n                Write-Output-JSON $jsonData\n            }\n        }\n        \n        \"CSV\" {\n            # Build CSV output\n            $csvContent = \"\"\n            \n            if ($selectedAction.ToUpper() -eq \"LIST VMS\") {\n                # CSV for VM list\n                $csvContent = \"Name,PowerState,IPAddresses,Uptime,CPUs,MemoryGB,UsedSpaceGB,ProvisionedSpaceGB,GuestOS,VMHost,Folder,ResourcePool,Notes`n\"\n                foreach ($vm in $actionData.vms) {\n                    $csvContent += \"`\"$($vm.Name)`\",$($vm.PowerState),`\"$($vm.IPAddresses)`\",`\"$($vm.Uptime)`\",$($vm.CPUs),$($vm.MemoryGB),$($vm.UsedSpaceGB),$($vm.ProvisionedSpaceGB),`\"$($vm.GuestOS)`\",`\"$($vm.VMHost)`\",`\"$($vm.Folder)`\",`\"$($vm.ResourcePool)`\",`\"$($vm.Notes)`\"`n\"\n                }\n                $csvContent = $csvContent.TrimEnd(\"`n\")\n            } elseif ($selectedAction.ToUpper() -eq \"LIST SNAPSHOTS\") {\n                # CSV for snapshot list\n                $csvContent = \"VMName,SnapshotName,Created,SizeGB,PowerState,Description`n\"\n                foreach ($snapshot in $actionData.snapshots) {\n                    $desc = if ([string]::IsNullOrWhiteSpace($snapshot.Description)) { \"\" } else { $snapshot.Description }\n                    $csvContent += \"`\"$($snapshot.VMName)`\",`\"$($snapshot.SnapshotName)`\",`\"$($snapshot.Created)`\",$($snapshot.SizeGB),`\"$($snapshot.PowerState)`\",`\"$desc`\"`n\"\n                }\n                $csvContent = $csvContent.TrimEnd(\"`n\")\n            } elseif ($selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS BEFORE DATE\") {\n                # CSV for removed snapshots\n                $csvContent = \"VMName,SnapshotName,Created,SizeGB,Status,Message`n\"\n                foreach ($snapshot in $actionData.removedSnapshots) {\n                    $csvContent += \"`\"$($snapshot.VMName)`\",`\"$($snapshot.SnapshotName)`\",`\"$($snapshot.Created)`\",$($snapshot.SizeGB),`\"$($snapshot.Status)`\",`\"$($snapshot.Message)`\"`n\"\n                }\n                foreach ($skipped in $actionData.skippedSnapshots) {\n                    $csvContent += \"`\"$($skipped.VMName)`\",`\"$($skipped.SnapshotName)`\",`\"$($skipped.Created)`\",$($skipped.SizeGB),`\"Skipped`\",`\"$($skipped.Reason)`\"`n\"\n                }\n                foreach ($failed in $actionData.failedRemovals) {\n                    $csvContent += \"`\"$($failed.VMName)`\",`\"$($failed.SnapshotName)`\",`\"$($failed.Created)`\",$($failed.SizeGB),`\"$($failed.Status)`\",`\"$($failed.Message)`\"`n\"\n                }\n                $csvContent = $csvContent.TrimEnd(\"`n\")\n            } elseif ($selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS BEFORE NUMBER OF WEEKS\") {\n                # CSV for removed snapshots (weeks-based)\n                $csvContent = \"VMName,SnapshotName,Created,AgeDays,SizeGB,Status,Message`n\"\n                foreach ($snapshot in $actionData.removedSnapshots) {\n                    $csvContent += \"`\"$($snapshot.VMName)`\",`\"$($snapshot.SnapshotName)`\",`\"$($snapshot.Created)`\",$($snapshot.AgeDays),$($snapshot.SizeGB),`\"$($snapshot.Status)`\",`\"$($snapshot.Message)`\"`n\"\n                }\n                foreach ($skipped in $actionData.skippedSnapshots) {\n                    $csvContent += \"`\"$($skipped.VMName)`\",`\"$($skipped.SnapshotName)`\",`\"$($skipped.Created)`\",$($skipped.AgeDays),$($skipped.SizeGB),`\"Skipped`\",`\"$($skipped.Reason)`\"`n\"\n                }\n                foreach ($failed in $actionData.failedRemovals) {\n                    $csvContent += \"`\"$($failed.VMName)`\",`\"$($failed.SnapshotName)`\",`\"$($failed.Created)`\",$($failed.AgeDays),$($failed.SizeGB),`\"$($failed.Status)`\",`\"$($failed.Message)`\"`n\"\n                }\n                $csvContent = $csvContent.TrimEnd(\"`n\")\n            } elseif ($selectedAction.ToUpper() -eq \"REMOVE ALL SNAPSHOTS\") {\n                # CSV for removed all snapshots\n                $csvContent = \"VMName,SnapshotName,Created,AgeDays,SizeGB,Status,Message`n\"\n                foreach ($snapshot in $actionData.removedSnapshots) {\n                    $csvContent += \"`\"$($snapshot.VMName)`\",`\"$($snapshot.SnapshotName)`\",`\"$($snapshot.Created)`\",$($snapshot.AgeDays),$($snapshot.SizeGB),`\"$($snapshot.Status)`\",`\"$($snapshot.Message)`\"`n\"\n                }\n                foreach ($skipped in $actionData.skippedSnapshots) {\n                    $csvContent += \"`\"$($skipped.VMName)`\",`\"$($skipped.SnapshotName)`\",`\"$($skipped.Created)`\",$($skipped.AgeDays),$($skipped.SizeGB),`\"Skipped`\",`\"$($skipped.Reason)`\"`n\"\n                }\n                foreach ($failed in $actionData.failedRemovals) {\n                    $csvContent += \"`\"$($failed.VMName)`\",`\"$($failed.SnapshotName)`\",`\"$($failed.Created)`\",$($failed.AgeDays),$($failed.SizeGB),`\"$($failed.Status)`\",`\"$($failed.Message)`\"`n\"\n                }\n                $csvContent = $csvContent.TrimEnd(\"`n\")\n            } elseif ($selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS CONTAINING SPECIFIC TEXT\") {\n                # CSV for removed snapshots containing text\n                $csvContent = \"VMName,SnapshotName,Created,AgeDays,SizeGB,Status,Message`n\"\n                foreach ($snapshot in $actionData.removedSnapshots) {\n                    $csvContent += \"`\"$($snapshot.VMName)`\",`\"$($snapshot.SnapshotName)`\",`\"$($snapshot.Created)`\",$($snapshot.AgeDays),$($snapshot.SizeGB),`\"$($snapshot.Status)`\",`\"$($snapshot.Message)`\"`n\"\n                }\n                foreach ($skipped in $actionData.skippedSnapshots) {\n                    $csvContent += \"`\"$($skipped.VMName)`\",`\"$($skipped.SnapshotName)`\",`\"$($skipped.Created)`\",$($skipped.AgeDays),$($skipped.SizeGB),`\"Skipped`\",`\"$($skipped.Reason)`\"`n\"\n                }\n                foreach ($failed in $actionData.failedRemovals) {\n                    $csvContent += \"`\"$($failed.VMName)`\",`\"$($failed.SnapshotName)`\",`\"$($failed.Created)`\",$($failed.AgeDays),$($failed.SizeGB),`\"$($failed.Status)`\",`\"$($failed.Message)`\"`n\"\n                }\n                $csvContent = $csvContent.TrimEnd(\"`n\")\n            } elseif ($selectedAction.ToUpper() -eq \"CREATE VM SNAPSHOT\") {\n                # CSV for created snapshots\n                $csvContent = \"VMName,SnapshotName,Description,Created,SizeGB,Memory,Status,Message`n\"\n                foreach ($snapshot in $actionData.createdSnapshots) {\n                    $memoryStr = if ($snapshot.Memory) { \"Yes\" } else { \"No\" }\n                    $csvContent += \"`\"$($snapshot.VMName)`\",`\"$($snapshot.SnapshotName)`\",`\"$($snapshot.Description)`\",`\"$($snapshot.Created)`\",$($snapshot.SizeGB),`\"$memoryStr`\",`\"$($snapshot.Status)`\",`\"$($snapshot.Message)`\"`n\"\n                }\n                foreach ($failed in $actionData.failedSnapshots) {\n                    $memoryStr = if ($failed.Memory) { \"Yes\" } else { \"No\" }\n                    $csvContent += \"`\"$($failed.VMName)`\",`\"$($failed.SnapshotName)`\",`\"$($failed.Description)`\",`\"`\",$memoryStr,`\"$($failed.Status)`\",`\"$($failed.Message)`\"`n\"\n                }\n                $csvContent = $csvContent.TrimEnd(\"`n\")\n            }\n            \n            if ($exportToFile) {\n                # Generate filename with timestamp\n                $timestamp = Get-Date -Format \"yyyyMMdd_HHmmss\"\n                $filename = \"vmware_vm_$($selectedAction.ToLower())_$timestamp.csv\"\n                \n                # Write CSV to file\n                $csvContent | Out-File -FilePath $filename -Encoding UTF8 -NoNewline\n                Write-Host \"CSV file created: $filename\"\n                \n                # Output CSV data AND file reference\n                Write-Output-JSON @{\n                    xy = 1\n                    data = $csvContent\n                    files = @(\n                        @{\n                            path = $filename\n                            name = $filename\n                        }\n                    )\n                }\n            } else {\n                # Output CSV data only\n                Write-Output-JSON @{\n                    xy = 1\n                    data = $csvContent\n                }\n            }\n        }\n        \n        \"MD\" {\n            # Build Markdown output\n            $markdownContent = \"# VMware VM Operations Report`n`n\"\n            $markdownContent += \"## Operation Details`n`n\"\n            $markdownContent += \"| Property | Value |`n\"\n            $markdownContent += \"|----------|-------|`n\"\n            $markdownContent += \"| **Action** | $($actionData.action) |`n\"\n            $markdownContent += \"| **vCenter Server** | $($actionData.vcenterServer) |`n\"\n            $markdownContent += \"| **Timestamp** | $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss') |`n\"\n            $markdownContent += \"`n\"\n            \n            if ($selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS BEFORE DATE\") {\n        # Display snapshot removal results\n        $markdownContent += \"## Snapshot Removal Summary`n`n\"\n        $markdownContent += \"**Target Date**: $($actionData.targetDate)`n`n\"\n        $markdownContent += \"**Removed**: $($actionData.removedCount) | **Failed**: $($actionData.failedCount) | **Total Processed**: $($actionData.totalProcessed)`n`n\"\n        \n        if ($actionData.removedSnapshots.Count -gt 0) {\n            $markdownContent += \"## Successfully Removed Snapshots ($($actionData.removedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Size (GB) |`n\"\n            $markdownContent += \"|---------|---------------|---------|-----------|`n\"\n            \n            foreach ($snapshot in $actionData.removedSnapshots) {\n                $markdownContent += \"| **$($snapshot.VMName)** | $($snapshot.SnapshotName) | $($snapshot.Created) | $($snapshot.SizeGB) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.failedRemovals.Count -gt 0) {\n            $markdownContent += \"## Failed Removals ($($actionData.failedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Size (GB) | Error Message |`n\"\n            $markdownContent += \"|---------|---------------|---------|-----------|---------------|`n\"\n            \n            foreach ($failed in $actionData.failedRemovals) {\n                $markdownContent += \"| **$($failed.VMName)** | $($failed.SnapshotName) | $($failed.Created) | $($failed.SizeGB) | $($failed.Message) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n            if ($actionData.removedCount -eq 0 -and $actionData.failedCount -eq 0) {\n                $markdownContent += \"## No Snapshots Found`n`n\"\n                $markdownContent += \"No snapshots were found before the target date $($actionData.targetDate).`n`n\"\n            }\n            } elseif ($selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS BEFORE NUMBER OF WEEKS\") {\n        # Display snapshot removal results for weeks-based removal\n        $markdownContent += \"## Snapshot Removal Summary`n`n\"\n        $markdownContent += \"**Number of Weeks**: $($actionData.numberOfWeeks) week(s)`n`n\"\n        $markdownContent += \"**Target Date**: $($actionData.targetDate) (snapshots older than this are removed)`n`n\"\n        $markdownContent += \"**Removed**: $($actionData.removedCount) | **Failed**: $($actionData.failedCount) | **Total Processed**: $($actionData.totalProcessed)`n`n\"\n        \n        if ($actionData.removedSnapshots.Count -gt 0) {\n            $markdownContent += \"## Successfully Removed Snapshots ($($actionData.removedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Age (Days) | Size (GB) |`n\"\n            $markdownContent += \"|---------|---------------|---------|------------|-----------|`n\"\n            \n            foreach ($snapshot in $actionData.removedSnapshots) {\n                $markdownContent += \"| **$($snapshot.VMName)** | $($snapshot.SnapshotName) | $($snapshot.Created) | $($snapshot.AgeDays) | $($snapshot.SizeGB) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.failedRemovals.Count -gt 0) {\n            $markdownContent += \"## Failed Removals ($($actionData.failedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Age (Days) | Size (GB) | Error Message |`n\"\n            $markdownContent += \"|---------|---------------|---------|------------|-----------|---------------|`n\"\n            \n            foreach ($failed in $actionData.failedRemovals) {\n                $markdownContent += \"| **$($failed.VMName)** | $($failed.SnapshotName) | $($failed.Created) | $($failed.AgeDays) | $($failed.SizeGB) | $($failed.Message) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n            if ($actionData.removedCount -eq 0 -and $actionData.failedCount -eq 0) {\n                $markdownContent += \"## No Snapshots Found`n`n\"\n                $markdownContent += \"No snapshots older than $($actionData.numberOfWeeks) week(s) were found.`n`n\"\n            }\n            } elseif ($selectedAction.ToUpper() -eq \"REMOVE ALL SNAPSHOTS\") {\n        # Display snapshot removal results for all snapshots\n        $markdownContent += \"## Snapshot Removal Summary`n`n\"\n        $markdownContent += \"**Action**: Remove ALL Snapshots`n`n\"\n        $markdownContent += \"**Removed**: $($actionData.removedCount) | **Failed**: $($actionData.failedCount) | **Total Processed**: $($actionData.totalProcessed)`n`n\"\n        \n        if ($actionData.removedSnapshots.Count -gt 0) {\n            $markdownContent += \"## Successfully Removed Snapshots ($($actionData.removedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Age (Days) | Size (GB) |`n\"\n            $markdownContent += \"|---------|---------------|---------|------------|-----------|`n\"\n            \n            foreach ($snapshot in $actionData.removedSnapshots) {\n                $markdownContent += \"| **$($snapshot.VMName)** | $($snapshot.SnapshotName) | $($snapshot.Created) | $($snapshot.AgeDays) | $($snapshot.SizeGB) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.failedRemovals.Count -gt 0) {\n            $markdownContent += \"## Failed Removals ($($actionData.failedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Age (Days) | Size (GB) | Error Message |`n\"\n            $markdownContent += \"|---------|---------------|---------|------------|-----------|---------------|`n\"\n            \n            foreach ($failed in $actionData.failedRemovals) {\n                $markdownContent += \"| **$($failed.VMName)** | $($failed.SnapshotName) | $($failed.Created) | $($failed.AgeDays) | $($failed.SizeGB) | $($failed.Message) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n            if ($actionData.removedCount -eq 0 -and $actionData.failedCount -eq 0) {\n                $markdownContent += \"## No Snapshots Found`n`n\"\n                $markdownContent += \"No snapshots were found in the vCenter environment.`n`n\"\n            }\n            } elseif ($selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS CONTAINING SPECIFIC TEXT\") {\n        # Display snapshot removal results for text-based search\n        $markdownContent += \"## Snapshot Removal Summary`n`n\"\n        $markdownContent += \"**Search Text**: $($actionData.searchText)`n`n\"\n        $markdownContent += \"**Removed**: $($actionData.removedCount) | **Failed**: $($actionData.failedCount) | **Skipped**: $($actionData.skippedCount) | **Total Processed**: $($actionData.totalProcessed)`n`n\"\n        \n        if ($actionData.removedSnapshots.Count -gt 0) {\n            $markdownContent += \"## Successfully Removed Snapshots ($($actionData.removedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Age (Days) | Size (GB) |`n\"\n            $markdownContent += \"|---------|---------------|---------|------------|-----------|`n\"\n            \n            foreach ($snapshot in $actionData.removedSnapshots) {\n                $markdownContent += \"| **$($snapshot.VMName)** | $($snapshot.SnapshotName) | $($snapshot.Created) | $($snapshot.AgeDays) | $($snapshot.SizeGB) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.skippedSnapshots.Count -gt 0) {\n            $markdownContent += \"## Skipped Snapshots ($($actionData.skippedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Age (Days) | Size (GB) | Reason |`n\"\n            $markdownContent += \"|---------|---------------|---------|------------|-----------|--------|`n\"\n            \n            foreach ($skipped in $actionData.skippedSnapshots) {\n                $markdownContent += \"| **$($skipped.VMName)** | $($skipped.SnapshotName) | $($skipped.Created) | $($skipped.AgeDays) | $($skipped.SizeGB) | $($skipped.Reason) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.failedRemovals.Count -gt 0) {\n            $markdownContent += \"## Failed Removals ($($actionData.failedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Created | Age (Days) | Size (GB) | Error Message |`n\"\n            $markdownContent += \"|---------|---------------|---------|------------|-----------|---------------|`n\"\n            \n            foreach ($failed in $actionData.failedRemovals) {\n                $markdownContent += \"| **$($failed.VMName)** | $($failed.SnapshotName) | $($failed.Created) | $($failed.AgeDays) | $($failed.SizeGB) | $($failed.Message) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n            if ($actionData.removedCount -eq 0 -and $actionData.failedCount -eq 0) {\n                $markdownContent += \"## No Snapshots Found`n`n\"\n                $markdownContent += \"No snapshots containing the text '$($actionData.searchText)' were found.`n`n\"\n            }\n            } elseif ($selectedAction.ToUpper() -eq \"CREATE VM SNAPSHOT\") {\n        # Display snapshot creation results\n        $markdownContent += \"## Snapshot Creation Summary`n`n\"\n        $markdownContent += \"**Snapshot Name**: $($actionData.snapshotName)`n`n\"\n        $markdownContent += \"**Description**: $($actionData.description)`n`n\"\n        $markdownContent += \"**Memory Snapshot**: $($actionData.memory)`n`n\"\n        $markdownContent += \"**Unique Identifier**: $($actionData.uniqueIdentifier)`n`n\"\n        $markdownContent += \"**Created**: $($actionData.createdCount) | **Failed**: $($actionData.failedCount) | **Total Processed**: $($actionData.totalProcessed)`n`n\"\n        \n        if ($actionData.createdSnapshots.Count -gt 0) {\n            $markdownContent += \"## Successfully Created Snapshots ($($actionData.createdCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Description | Created | Size (GB) | Memory |`n\"\n            $markdownContent += \"|---------|---------------|-------------|---------|-----------|--------|`n\"\n            \n            foreach ($snapshot in $actionData.createdSnapshots) {\n                $memoryIcon = if ($snapshot.Memory) { \"\" } else { \"\" }\n                $markdownContent += \"| **$($snapshot.VMName)** | $($snapshot.SnapshotName) | $($snapshot.Description) | $($snapshot.Created) | $($snapshot.SizeGB) | $memoryIcon |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n        if ($actionData.failedSnapshots.Count -gt 0) {\n            $markdownContent += \"## Failed Snapshot Creations ($($actionData.failedCount))`n`n\"\n            $markdownContent += \"| VM Name | Snapshot Name | Error Message |`n\"\n            $markdownContent += \"|---------|---------------|---------------|`n\"\n            \n            foreach ($failed in $actionData.failedSnapshots) {\n                $markdownContent += \"| **$($failed.VMName)** | $($failed.SnapshotName) | $($failed.Message) |`n\"\n            }\n            $markdownContent += \"`n\"\n        }\n        \n            if ($actionData.createdCount -eq 0 -and $actionData.failedCount -gt 0) {\n                $markdownContent += \"## No Snapshots Created`n`n\"\n                $markdownContent += \"All snapshot creation attempts failed. Please check the error messages above.`n`n\"\n            }\n            } elseif ($selectedAction.ToUpper() -eq \"LIST VMS\") {\n                $markdownContent += \"## Virtual Machines ($($actionData.vmCount))`n`n\"\n                $markdownContent += \"| Name | Power State | IP Addresses | Uptime | CPUs | Memory (GB) | Used Space (GB) | Guest OS | Host |`n\"\n                $markdownContent += \"|------|-------------|--------------|--------|------|-------------|-----------------|----------|------|`n\"\n                \n                foreach ($vm in $actionData.vms) {\n                    # Format IP addresses with line breaks for Markdown\n                    $ipFormatted = if ($vm.IPAddresses -ne \"N/A\" -and $vm.IPAddresses -match \",\") {\n                        ($vm.IPAddresses -split \", \") -join \"<br>\"\n                    } else {\n                        $vm.IPAddresses\n                    }\n                    $markdownContent += \"| **$($vm.Name)** | $($vm.PowerState) | $ipFormatted | $($vm.Uptime) | $($vm.CPUs) | $($vm.MemoryGB) | $($vm.UsedSpaceGB) | $($vm.GuestOS) | $($vm.VMHost) |`n\"\n                }\n            }\n            \n            if ($exportToFile) {\n                # Generate filename with timestamp\n                $timestamp = Get-Date -Format \"yyyyMMdd_HHmmss\"\n                $filename = \"vmware_vm_$($selectedAction.ToLower())_$timestamp.md\"\n                \n                # Write Markdown to file\n                $markdownContent | Out-File -FilePath $filename -Encoding UTF8 -NoNewline\n                Write-Host \"Markdown file created: $filename\"\n                \n                # Output markdown content directly as data AND file reference\n                $mdData = @{\n                    xy = 1\n                    data = $markdownContent\n                    files = @(\n                        @{\n                            path = $filename\n                            name = $filename\n                        }\n                    )\n                }\n                Write-Output-JSON $mdData\n            } else {\n                # Output markdown directly (no file)\n                $mdData = @{\n                    xy = 1\n                    data = $markdownContent\n                }\n                Write-Output-JSON $mdData\n            }\n        }\n        \n        \"HTML\" {\n            # Build HTML output\n            $htmlContent = @\"\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <title>VMware VM Operations Report</title>\n    <style>\n        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }\n        h1 { color: #333; border-bottom: 3px solid #0078d4; padding-bottom: 10px; }\n        h2 { color: #0078d4; margin-top: 30px; }\n        table { border-collapse: collapse; width: 100%; margin: 20px 0; background-color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }\n        th { background-color: #0078d4; color: white; padding: 12px; text-align: left; font-weight: bold; }\n        td { padding: 10px; border-bottom: 1px solid #ddd; }\n        tr:hover { background-color: #f0f0f0; }\n        .info-table { width: auto; max-width: 500px; }\n        .powered-off { background-color: #ffebee; }\n        .status { font-weight: bold; }\n        .ip-list { line-height: 1.6; }\n    </style>\n</head>\n<body>\n    <h1>VMware VM Operations Report</h1>\n    \n    <h2>Operation Details</h2>\n    <table class=\"info-table\">\n        <tr><th>Property</th><th>Value</th></tr>\n        <tr><td><strong>Action</strong></td><td>$($actionData.action)</td></tr>\n        <tr><td><strong>vCenter Server</strong></td><td>$($actionData.vcenterServer)</td></tr>\n        <tr><td><strong>Timestamp</strong></td><td>$(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')</td></tr>\n\"@\n            \n            # Add action-specific info to table\n            if ($selectedAction.ToUpper() -eq \"LIST VMS\") {\n                $htmlContent += \"        <tr><td><strong>Total VMs</strong></td><td>$($actionData.vmCount)</td></tr>`n\"\n            } elseif ($selectedAction.ToUpper() -eq \"LIST SNAPSHOTS\") {\n                $htmlContent += \"        <tr><td><strong>Total Snapshots</strong></td><td>$($actionData.snapshotCount)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>VMs with Snapshots</strong></td><td>$($actionData.vmWithSnapshotsCount)</td></tr>`n\"\n            } elseif ($selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS BEFORE DATE\") {\n                $htmlContent += \"        <tr><td><strong>Target Date</strong></td><td>$($actionData.targetDate)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Removed</strong></td><td>$($actionData.removedCount)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Failed</strong></td><td>$($actionData.failedCount)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Total Processed</strong></td><td>$($actionData.totalProcessed)</td></tr>`n\"\n            } elseif ($selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS BEFORE NUMBER OF WEEKS\") {\n                $htmlContent += \"        <tr><td><strong>Number of Weeks</strong></td><td>$($actionData.numberOfWeeks)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Target Date</strong></td><td>$($actionData.targetDate)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Removed</strong></td><td>$($actionData.removedCount)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Failed</strong></td><td>$($actionData.failedCount)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Total Processed</strong></td><td>$($actionData.totalProcessed)</td></tr>`n\"\n            } elseif ($selectedAction.ToUpper() -eq \"REMOVE ALL SNAPSHOTS\") {\n                $htmlContent += \"        <tr><td><strong>Removed</strong></td><td>$($actionData.removedCount)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Failed</strong></td><td>$($actionData.failedCount)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Total Processed</strong></td><td>$($actionData.totalProcessed)</td></tr>`n\"\n            } elseif ($selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS CONTAINING SPECIFIC TEXT\") {\n                $htmlContent += \"        <tr><td><strong>Search Text</strong></td><td>$($actionData.searchText)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Removed</strong></td><td>$($actionData.removedCount)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Failed</strong></td><td>$($actionData.failedCount)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Skipped</strong></td><td>$($actionData.skippedCount)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Total Processed</strong></td><td>$($actionData.totalProcessed)</td></tr>`n\"\n            } elseif ($selectedAction.ToUpper() -eq \"CREATE VM SNAPSHOT\") {\n                $htmlContent += \"        <tr><td><strong>Snapshot Name</strong></td><td>$($actionData.snapshotName)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Description</strong></td><td>$($actionData.description)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Memory Snapshot</strong></td><td>$($actionData.memory)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Unique Identifier</strong></td><td>$($actionData.uniqueIdentifier)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Created</strong></td><td>$($actionData.createdCount)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Failed</strong></td><td>$($actionData.failedCount)</td></tr>`n\"\n                $htmlContent += \"        <tr><td><strong>Total Processed</strong></td><td>$($actionData.totalProcessed)</td></tr>`n\"\n            }\n            \n            $htmlContent += \"    </table>`n\"\n            \n            if ($selectedAction.ToUpper() -eq \"LIST VMS\") {\n                # Separate VMs by power state\n                $poweredOnVMs = $actionData.vms | Where-Object { $_.PowerState -eq \"PoweredOn\" }\n                $poweredOffVMs = $actionData.vms | Where-Object { $_.PowerState -eq \"PoweredOff\" }\n                \n                # PoweredOn VMs table\n                if ($poweredOnVMs.Count -gt 0) {\n                    $htmlContent += \"`n    <h2>Powered On Virtual Machines ($($poweredOnVMs.Count))</h2>`n\"\n                    $htmlContent += \"    <table>`n\"\n                    $htmlContent += \"        <tr><th>Name</th><th>IP Addresses</th><th>Uptime</th><th>CPUs</th><th>Memory (GB)</th><th>Used Space (GB)</th><th>Guest OS</th><th>Host</th></tr>`n\"\n                    \n                    foreach ($vm in $poweredOnVMs) {\n                        # Format IP addresses with line breaks for HTML\n                        $ipFormatted = if ($vm.IPAddresses -ne \"N/A\" -and $vm.IPAddresses -match \",\") {\n                            ($vm.IPAddresses -split \", \") -join \"<br>\"\n                        } else {\n                            $vm.IPAddresses\n                        }\n                        $htmlContent += \"        <tr><td><strong>$($vm.Name)</strong></td><td class='ip-list'>$ipFormatted</td><td>$($vm.Uptime)</td><td>$($vm.CPUs)</td><td>$($vm.MemoryGB)</td><td>$($vm.UsedSpaceGB)</td><td>$($vm.GuestOS)</td><td>$($vm.VMHost)</td></tr>`n\"\n                    }\n                    \n                    $htmlContent += \"    </table>`n\"\n                }\n                \n                # PoweredOff VMs table\n                if ($poweredOffVMs.Count -gt 0) {\n                    $htmlContent += \"`n    <h2>Powered Off Virtual Machines ($($poweredOffVMs.Count))</h2>`n\"\n                    $htmlContent += \"    <table>`n\"\n                    $htmlContent += \"        <tr><th>Name</th><th>CPUs</th><th>Memory (GB)</th><th>Used Space (GB)</th><th>Guest OS</th><th>Host</th></tr>`n\"\n                    \n                    foreach ($vm in $poweredOffVMs) {\n                        $htmlContent += \"        <tr class='powered-off'><td><strong>$($vm.Name)</strong></td><td>$($vm.CPUs)</td><td>$($vm.MemoryGB)</td><td>$($vm.UsedSpaceGB)</td><td>$($vm.GuestOS)</td><td>$($vm.VMHost)</td></tr>`n\"\n                    }\n                    \n                    $htmlContent += \"    </table>`n\"\n                }\n            } elseif ($selectedAction.ToUpper() -eq \"LIST SNAPSHOTS\") {\n                # List snapshots table\n                if ($actionData.snapshots.Count -gt 0) {\n                    $htmlContent += \"`n    <h2>VM Snapshots ($($actionData.snapshotCount))</h2>`n\"\n                    $htmlContent += \"    <table>`n\"\n                    $htmlContent += \"        <tr><th>VM Name</th><th>Snapshot Name</th><th>Created</th><th>Size (GB)</th><th>Power State</th><th>Description</th></tr>`n\"\n                    \n                    foreach ($snapshot in $actionData.snapshots) {\n                        $desc = if ([string]::IsNullOrWhiteSpace($snapshot.Description)) { \"-\" } else { $snapshot.Description }\n                        $htmlContent += \"        <tr><td><strong>$($snapshot.VMName)</strong></td><td>$($snapshot.SnapshotName)</td><td>$($snapshot.Created)</td><td>$($snapshot.SizeGB)</td><td>$($snapshot.PowerState)</td><td>$desc</td></tr>`n\"\n                    }\n                    \n                    $htmlContent += \"    </table>`n\"\n                } else {\n                    $htmlContent += \"`n    <h2>No Snapshots Found</h2>`n\"\n                    $htmlContent += \"    <p>There are no snapshots in the vCenter environment.</p>`n\"\n                }\n            } elseif ($selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS BEFORE DATE\") {\n                # Removed snapshots table\n                if ($actionData.removedSnapshots.Count -gt 0) {\n                    $htmlContent += \"`n    <h2>Successfully Removed Snapshots ($($actionData.removedCount))</h2>`n\"\n                    $htmlContent += \"    <table>`n\"\n                    $htmlContent += \"        <tr><th>VM Name</th><th>Snapshot Name</th><th>Created</th><th>Size (GB)</th></tr>`n\"\n                    \n                    foreach ($snapshot in $actionData.removedSnapshots) {\n                        $htmlContent += \"        <tr><td><strong>$($snapshot.VMName)</strong></td><td>$($snapshot.SnapshotName)</td><td>$($snapshot.Created)</td><td>$($snapshot.SizeGB)</td></tr>`n\"\n                    }\n                    \n                    $htmlContent += \"    </table>`n\"\n                }\n                \n                # Skipped snapshots table\n                if ($actionData.skippedSnapshots.Count -gt 0) {\n                    $htmlContent += \"`n    <h2>Skipped Snapshots ($($actionData.skippedCount))</h2>`n\"\n                    $htmlContent += \"    <table>`n\"\n                    $htmlContent += \"        <tr><th>VM Name</th><th>Snapshot Name</th><th>Created</th><th>Size (GB)</th><th>Reason</th></tr>`n\"\n                    \n                    foreach ($skipped in $actionData.skippedSnapshots) {\n                        $htmlContent += \"        <tr style='background-color: #ffffcc;'><td><strong>$($skipped.VMName)</strong></td><td>$($skipped.SnapshotName)</td><td>$($skipped.Created)</td><td>$($skipped.SizeGB)</td><td>$($skipped.Reason)</td></tr>`n\"\n                    }\n                    \n                    $htmlContent += \"    </table>`n\"\n                }\n                \n                # Failed removals table\n                if ($actionData.failedRemovals.Count -gt 0) {\n                    $htmlContent += \"`n    <h2>Failed Removals ($($actionData.failedCount))</h2>`n\"\n                    $htmlContent += \"    <table>`n\"\n                    $htmlContent += \"        <tr><th>VM Name</th><th>Snapshot Name</th><th>Created</th><th>Size (GB)</th><th>Error Message</th></tr>`n\"\n                    \n                    foreach ($failed in $actionData.failedRemovals) {\n                        $htmlContent += \"        <tr style='background-color: #ffcccc;'><td><strong>$($failed.VMName)</strong></td><td>$($failed.SnapshotName)</td><td>$($failed.Created)</td><td>$($failed.SizeGB)</td><td>$($failed.Message)</td></tr>`n\"\n                    }\n                    \n                    $htmlContent += \"    </table>`n\"\n                }\n                \n                if ($actionData.removedCount -eq 0 -and $actionData.failedCount -eq 0) {\n                    $htmlContent += \"`n    <h2>No Snapshots Found</h2>`n\"\n                    $htmlContent += \"    <p>No snapshots were found before the target date $($actionData.targetDate).</p>`n\"\n                }\n            } elseif ($selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS BEFORE NUMBER OF WEEKS\") {\n                # Removed snapshots table (weeks-based)\n                if ($actionData.removedSnapshots.Count -gt 0) {\n                    $htmlContent += \"`n    <h2>Successfully Removed Snapshots ($($actionData.removedCount))</h2>`n\"\n                    $htmlContent += \"    <table>`n\"\n                    $htmlContent += \"        <tr><th>VM Name</th><th>Snapshot Name</th><th>Created</th><th>Age (Days)</th><th>Size (GB)</th></tr>`n\"\n                    \n                    foreach ($snapshot in $actionData.removedSnapshots) {\n                        $htmlContent += \"        <tr><td><strong>$($snapshot.VMName)</strong></td><td>$($snapshot.SnapshotName)</td><td>$($snapshot.Created)</td><td>$($snapshot.AgeDays)</td><td>$($snapshot.SizeGB)</td></tr>`n\"\n                    }\n                    \n                    $htmlContent += \"    </table>`n\"\n                }\n                \n                # Skipped snapshots table\n                if ($actionData.skippedSnapshots.Count -gt 0) {\n                    $htmlContent += \"`n    <h2>Skipped Snapshots ($($actionData.skippedCount))</h2>`n\"\n                    $htmlContent += \"    <table>`n\"\n                    $htmlContent += \"        <tr><th>VM Name</th><th>Snapshot Name</th><th>Created</th><th>Age (Days)</th><th>Size (GB)</th><th>Reason</th></tr>`n\"\n                    \n                    foreach ($skipped in $actionData.skippedSnapshots) {\n                        $htmlContent += \"        <tr style='background-color: #ffffcc;'><td><strong>$($skipped.VMName)</strong></td><td>$($skipped.SnapshotName)</td><td>$($skipped.Created)</td><td>$($skipped.AgeDays)</td><td>$($skipped.SizeGB)</td><td>$($skipped.Reason)</td></tr>`n\"\n                    }\n                    \n                    $htmlContent += \"    </table>`n\"\n                }\n                \n                # Failed removals table\n                if ($actionData.failedRemovals.Count -gt 0) {\n                    $htmlContent += \"`n    <h2>Failed Removals ($($actionData.failedCount))</h2>`n\"\n                    $htmlContent += \"    <table>`n\"\n                    $htmlContent += \"        <tr><th>VM Name</th><th>Snapshot Name</th><th>Created</th><th>Age (Days)</th><th>Size (GB)</th><th>Error Message</th></tr>`n\"\n                    \n                    foreach ($failed in $actionData.failedRemovals) {\n                        $htmlContent += \"        <tr style='background-color: #ffcccc;'><td><strong>$($failed.VMName)</strong></td><td>$($failed.SnapshotName)</td><td>$($failed.Created)</td><td>$($failed.AgeDays)</td><td>$($failed.SizeGB)</td><td>$($failed.Message)</td></tr>`n\"\n                    }\n                    \n                    $htmlContent += \"    </table>`n\"\n                }\n                \n                if ($actionData.removedCount -eq 0 -and $actionData.failedCount -eq 0) {\n                    $htmlContent += \"`n    <h2>No Snapshots Found</h2>`n\"\n                    $htmlContent += \"    <p>No snapshots older than $($actionData.numberOfWeeks) week(s) were found.</p>`n\"\n                }\n            } elseif ($selectedAction.ToUpper() -eq \"REMOVE ALL SNAPSHOTS\") {\n                # Removed all snapshots tables\n                if ($actionData.removedSnapshots.Count -gt 0) {\n                    $htmlContent += \"`n    <h2>Successfully Removed Snapshots ($($actionData.removedCount))</h2>`n\"\n                    $htmlContent += \"    <table>`n\"\n                    $htmlContent += \"        <tr><th>VM Name</th><th>Snapshot Name</th><th>Created</th><th>Age (Days)</th><th>Size (GB)</th></tr>`n\"\n                    \n                    foreach ($snapshot in $actionData.removedSnapshots) {\n                        $htmlContent += \"        <tr><td><strong>$($snapshot.VMName)</strong></td><td>$($snapshot.SnapshotName)</td><td>$($snapshot.Created)</td><td>$($snapshot.AgeDays)</td><td>$($snapshot.SizeGB)</td></tr>`n\"\n                    }\n                    \n                    $htmlContent += \"    </table>`n\"\n                }\n                \n                # Skipped snapshots table\n                if ($actionData.skippedSnapshots.Count -gt 0) {\n                    $htmlContent += \"`n    <h2>Skipped Snapshots ($($actionData.skippedCount))</h2>`n\"\n                    $htmlContent += \"    <table>`n\"\n                    $htmlContent += \"        <tr><th>VM Name</th><th>Snapshot Name</th><th>Created</th><th>Age (Days)</th><th>Size (GB)</th><th>Reason</th></tr>`n\"\n                    \n                    foreach ($skipped in $actionData.skippedSnapshots) {\n                        $htmlContent += \"        <tr style='background-color: #ffffcc;'><td><strong>$($skipped.VMName)</strong></td><td>$($skipped.SnapshotName)</td><td>$($skipped.Created)</td><td>$($skipped.AgeDays)</td><td>$($skipped.SizeGB)</td><td>$($skipped.Reason)</td></tr>`n\"\n                    }\n                    \n                    $htmlContent += \"    </table>`n\"\n                }\n                \n                # Failed removals table\n                if ($actionData.failedRemovals.Count -gt 0) {\n                    $htmlContent += \"`n    <h2>Failed Removals ($($actionData.failedCount))</h2>`n\"\n                    $htmlContent += \"    <table>`n\"\n                    $htmlContent += \"        <tr><th>VM Name</th><th>Snapshot Name</th><th>Created</th><th>Age (Days)</th><th>Size (GB)</th><th>Error Message</th></tr>`n\"\n                    \n                    foreach ($failed in $actionData.failedRemovals) {\n                        $htmlContent += \"        <tr style='background-color: #ffcccc;'><td><strong>$($failed.VMName)</strong></td><td>$($failed.SnapshotName)</td><td>$($failed.Created)</td><td>$($failed.AgeDays)</td><td>$($failed.SizeGB)</td><td>$($failed.Message)</td></tr>`n\"\n                    }\n                    \n                    $htmlContent += \"    </table>`n\"\n                }\n                \n                if ($actionData.removedCount -eq 0 -and $actionData.failedCount -eq 0) {\n                    $htmlContent += \"`n    <h2>No Snapshots Found</h2>`n\"\n                    $htmlContent += \"    <p>No snapshots were found in the vCenter environment.</p>`n\"\n                }\n            } elseif ($selectedAction.ToUpper() -eq \"REMOVE SNAPSHOTS CONTAINING SPECIFIC TEXT\") {\n                # Removed snapshots containing text tables\n                if ($actionData.removedSnapshots.Count -gt 0) {\n                    $htmlContent += \"`n    <h2>Successfully Removed Snapshots ($($actionData.removedCount))</h2>`n\"\n                    $htmlContent += \"    <table>`n\"\n                    $htmlContent += \"        <tr><th>VM Name</th><th>Snapshot Name</th><th>Created</th><th>Age (Days)</th><th>Size (GB)</th></tr>`n\"\n                    \n                    foreach ($snapshot in $actionData.removedSnapshots) {\n                        $htmlContent += \"        <tr><td><strong>$($snapshot.VMName)</strong></td><td>$($snapshot.SnapshotName)</td><td>$($snapshot.Created)</td><td>$($snapshot.AgeDays)</td><td>$($snapshot.SizeGB)</td></tr>`n\"\n                    }\n                    \n                    $htmlContent += \"    </table>`n\"\n                }\n                \n                # Skipped snapshots table\n                if ($actionData.skippedSnapshots.Count -gt 0) {\n                    $htmlContent += \"`n    <h2>Skipped Snapshots ($($actionData.skippedCount))</h2>`n\"\n                    $htmlContent += \"    <table>`n\"\n                    $htmlContent += \"        <tr><th>VM Name</th><th>Snapshot Name</th><th>Created</th><th>Age (Days)</th><th>Size (GB)</th><th>Reason</th></tr>`n\"\n                    \n                    foreach ($skipped in $actionData.skippedSnapshots) {\n                        $htmlContent += \"        <tr style='background-color: #ffffcc;'><td><strong>$($skipped.VMName)</strong></td><td>$($skipped.SnapshotName)</td><td>$($skipped.Created)</td><td>$($skipped.AgeDays)</td><td>$($skipped.SizeGB)</td><td>$($skipped.Reason)</td></tr>`n\"\n                    }\n                    \n                    $htmlContent += \"    </table>`n\"\n                }\n                \n                # Failed removals table\n                if ($actionData.failedRemovals.Count -gt 0) {\n                    $htmlContent += \"`n    <h2>Failed Removals ($($actionData.failedCount))</h2>`n\"\n                    $htmlContent += \"    <table>`n\"\n                    $htmlContent += \"        <tr><th>VM Name</th><th>Snapshot Name</th><th>Created</th><th>Age (Days)</th><th>Size (GB)</th><th>Error Message</th></tr>`n\"\n                    \n                    foreach ($failed in $actionData.failedRemovals) {\n                        $htmlContent += \"        <tr style='background-color: #ffcccc;'><td><strong>$($failed.VMName)</strong></td><td>$($failed.SnapshotName)</td><td>$($failed.Created)</td><td>$($failed.AgeDays)</td><td>$($failed.SizeGB)</td><td>$($failed.Message)</td></tr>`n\"\n                    }\n                    \n                    $htmlContent += \"    </table>`n\"\n                }\n                \n                if ($actionData.removedCount -eq 0 -and $actionData.failedCount -eq 0) {\n                    $htmlContent += \"`n    <h2>No Snapshots Found</h2>`n\"\n                    $htmlContent += \"    <p>No snapshots containing the text '$($actionData.searchText)' were found.</p>`n\"\n                }\n            } elseif ($selectedAction.ToUpper() -eq \"CREATE VM SNAPSHOT\") {\n                # Created snapshots table\n                if ($actionData.createdSnapshots.Count -gt 0) {\n                    $htmlContent += \"`n    <h2>Successfully Created Snapshots ($($actionData.createdCount))</h2>`n\"\n                    $htmlContent += \"    <table>`n\"\n                    $htmlContent += \"        <tr><th>VM Name</th><th>Snapshot Name</th><th>Description</th><th>Created</th><th>Size (GB)</th><th>Memory</th></tr>`n\"\n                    \n                    foreach ($snapshot in $actionData.createdSnapshots) {\n                        $memoryIcon = if ($snapshot.Memory) { \"\" } else { \"\" }\n                        $htmlContent += \"        <tr><td><strong>$($snapshot.VMName)</strong></td><td>$($snapshot.SnapshotName)</td><td>$($snapshot.Description)</td><td>$($snapshot.Created)</td><td>$($snapshot.SizeGB)</td><td>$memoryIcon</td></tr>`n\"\n                    }\n                    \n                    $htmlContent += \"    </table>`n\"\n                }\n                \n                # Failed snapshot creations table\n                if ($actionData.failedSnapshots.Count -gt 0) {\n                    $htmlContent += \"`n    <h2>Failed Snapshot Creations ($($actionData.failedCount))</h2>`n\"\n                    $htmlContent += \"    <table>`n\"\n                    $htmlContent += \"        <tr><th>VM Name</th><th>Snapshot Name</th><th>Error Message</th></tr>`n\"\n                    \n                    foreach ($failed in $actionData.failedSnapshots) {\n                        $htmlContent += \"        <tr style='background-color: #ffcccc;'><td><strong>$($failed.VMName)</strong></td><td>$($failed.SnapshotName)</td><td>$($failed.Message)</td></tr>`n\"\n                    }\n                    \n                    $htmlContent += \"    </table>`n\"\n                }\n                \n                if ($actionData.createdCount -eq 0 -and $actionData.failedCount -gt 0) {\n                    $htmlContent += \"`n    <h2>No Snapshots Created</h2>`n\"\n                    $htmlContent += \"    <p>All snapshot creation attempts failed. Please check the error messages above.</p>`n\"\n                }\n            }\n            \n            $htmlContent += @\"\n</body>\n</html>\n\"@\n            \n            if ($exportToFile) {\n                # Generate filename with timestamp\n                $timestamp = Get-Date -Format \"yyyyMMdd_HHmmss\"\n                $filename = \"vmware_vm_$($selectedAction.ToLower())_$timestamp.html\"\n                \n                # Write HTML to file\n                $htmlContent | Out-File -FilePath $filename -Encoding UTF8 -NoNewline\n                Write-Host \"HTML file created: $filename\"\n                \n                # Output HTML content as data AND file reference\n                $htmlData = @{\n                    xy = 1\n                    data = $htmlContent\n                    files = @(\n                        @{\n                            path = $filename\n                            name = $filename\n                        }\n                    )\n                }\n                Write-Output-JSON $htmlData\n            } else {\n                # Output HTML directly (no file)\n                $htmlData = @{\n                    xy = 1\n                    data = $htmlContent\n                }\n                Write-Output-JSON $htmlData\n            }\n        }\n        \n        default {\n            Write-Host \"Unknown export format: $exportFormat, defaulting to JSON\"\n            $jsonData = @{\n                xy = 1\n                data = $actionData\n            }\n            Write-Output-JSON $jsonData\n        }\n    }\n\n    $outputSW.Stop(); $perf.output = [math]::Round($outputSW.Elapsed.TotalSeconds,3); if ($debug) { Write-Host (\"PERF output={0:n3}s\" -f $perf.output) }\n    \n    # Disconnect from vCenter\n    Disconnect-VIServer -Server $viConnection -Confirm:$false -ErrorAction SilentlyContinue\n    Write-Host \"Disconnected from vCenter\"\n\n    # Output performance metrics for xyOps pie chart\n    $overallSW.Stop(); $perf.t = [math]::Round($overallSW.Elapsed.TotalSeconds,3)\n    Write-Output-JSON @{ xy = 1; perf = $perf }\n    if ($debug) {\n        Write-Host (\"PERF total={0:n3}s\" -f $perf.t)\n    }\n    \n    # Success message\n    $summary = \"Operation '$selectedAction' completed successfully\"\n    if ($selectedAction.ToUpper() -eq \"LISTVMS\") {\n        $summary += \": $($actionData.vmCount) VM(s) retrieved\"\n    }\n    \n    Send-Success -Description $summary\n}\ncatch {\n    Send-Error -Code 7 -Description \"Error: $($_.Exception.Message)\"\n    exit 1\n}",
				"groups": [],
				"format": "",
				"params": [
					{
						"id": "vcenterserver",
						"title": "vCenter server",
						"type": "text",
						"caption": "",
						"locked": false,
						"value": "",
						"variant": "text",
						"required": true
					},
					{
						"id": "selectedaction",
						"title": "Action",
						"type": "select",
						"caption": "",
						"locked": false,
						"value": "List VMs,List snapshots,Remove snapshots before date,Remove snapshots before number of weeks,Remove all snapshots,Remove snapshots containing specific text,Create VM snapshot"
					},
					{
						"id": "snapshotremovalexception",
						"title": "Snapshot removel exception",
						"type": "text",
						"caption": "Add text values separeted by comma's to skip snapshot removel if the text is found in the title or description of the snapshot. VEEAM is added as default value.",
						"locked": false,
						"value": "VEEAM",
						"variant": "text",
						"required": false
					},
					{
						"id": "dateinput",
						"title": "Date",
						"type": "text",
						"caption": "Used for \"Remove snapshot before date\" action",
						"locked": false,
						"value": "",
						"variant": "date",
						"required": false
					},
					{
						"id": "numberofweeks",
						"title": "Number of weeks",
						"type": "text",
						"caption": "Number of weeks to keep snapshots, removes any snapshot before.",
						"locked": false,
						"value": 4,
						"variant": "number",
						"required": false
					},
					{
						"id": "ignorecert",
						"title": "Ignore certificate validation",
						"type": "checkbox",
						"caption": "Ignore the vCenter certificate validation.",
						"locked": false,
						"value": true
					},
					{
						"id": "proxypolicy",
						"title": "Do not use proxy",
						"type": "checkbox",
						"caption": "",
						"locked": false,
						"value": true
					},
					{
						"id": "viservermode",
						"title": "Single vCenter server",
						"type": "checkbox",
						"caption": "Check if you are connecting to a single vCenter server setup, uncheck for multiple hosts",
						"locked": false,
						"value": true
					},
					{
						"id": "exportformat",
						"title": "Export format",
						"type": "select",
						"caption": "Select you export format: JSON, CSV, markdown, HTML",
						"locked": false,
						"value": "JSON,CSV,MD,HTML"
					},
					{
						"id": "exporttofile",
						"title": "Export to file",
						"type": "checkbox",
						"caption": "",
						"locked": false,
						"value": false
					},
					{
						"id": "snapshotname",
						"title": "Snapshot name",
						"type": "text",
						"caption": "If left empty, the snapshot name will be xyOps-VMWare-VM-current_timestamp.\nIf used whith action \"Remove snapshots containing specific text\" the text specified here will be the text searched for to delete the snapshot.",
						"locked": false,
						"value": "",
						"variant": "text",
						"required": false
					},
					{
						"id": "snapshotdescription",
						"title": "Snapshot description",
						"type": "textarea",
						"caption": "Snapshot description",
						"locked": false,
						"value": "",
						"required": false
					},
					{
						"id": "snapshotmemory",
						"title": "Include VM memory in snapshot",
						"type": "checkbox",
						"caption": "Take snapshot with VM memory included ",
						"locked": false,
						"value": true
					},
					{
						"id": "snapshotunique",
						"title": "Use unique snapshot identifier",
						"type": "select",
						"caption": "Choose if you would like to add a unique identifier after your custom snapshot name.",
						"locked": false,
						"value": "No,Unique short UID,Timestamp"
					},
					{
						"id": "vmname",
						"title": "VM name",
						"type": "text",
						"caption": "Choos the VM for the action. You van specify multiple VM seperated by a comma.",
						"locked": false,
						"value": "",
						"variant": "text",
						"required": false
					},
					{
						"id": "updateVCFPowerCLI",
						"title": "Check for VCF.PowerCLI update",
						"type": "checkbox",
						"caption": "WARNING, this wil check if there is a update available at every run of the plugin! Leave unchecked and enable this once in a while or use a seperate event with a simple vm list action to update this, for example once in a month.",
						"locked": false,
						"value": false
					},
					{
						"id": "debug",
						"title": "Debug",
						"type": "checkbox",
						"caption": "Enable the debug option and performance output.",
						"locked": true,
						"value": false
					}
				],
				"kill": "parent",
				"runner": false,
				"notes": "",
				"icon": "server",
				"uid": "",
				"gid": ""
			}
		}
	]
}
